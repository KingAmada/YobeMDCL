<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <title>Yobe State Mining Company</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Lucide Icons (UMD) -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

  <!-- html2canvas for downloading images -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Playfair+Display:ital,wght@0,600;0,800;1,600&display=swap');

    body { font-family: 'Inter', sans-serif; }
    .font-serif { font-family: 'Playfair Display', serif; }
    .pb-safe { padding-bottom: env(safe-area-inset-bottom); }

    /* Animations */
    @keyframes fade-in-up {
      from { opacity: 0; transform: translateY(20px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in-up { animation: fade-in-up .5s ease-out forwards; }

    @keyframes slide-in-right {
      from { opacity: 0; transform: translateX(20px); }
      to   { opacity: 1; transform: translateX(0); }
    }
    .animate-slide-in-right { animation: slide-in-right .4s ease-out forwards; }

    @keyframes pulse-ring {
      0% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
      70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
      100% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
    }
    .marker-pulse { animation: pulse-ring 2s infinite; }
    
    /* Custom Scrollbar for dashboards */
    .custom-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
    .custom-scroll::-webkit-scrollbar-track { background: transparent; }
    .custom-scroll::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 3px; }

    /* Security Patterns */
    .security-pattern {
      background-image: radial-gradient(#10b981 0.5px, transparent 0.5px), radial-gradient(#10b981 0.5px, #fcfbf7 0.5px);
      background-size: 20px 20px;
      background-position: 0 0, 10px 10px;
      opacity: 0.05;
    }

    .guilloche-border {
      border: 8px solid transparent;
      border-image: repeating-linear-gradient(45deg, #064e3b 0, #064e3b 10px, #d97706 10px, #d97706 20px) 1;
    }

    .watermark-ghost {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(-30deg);
      opacity: 0.03;
      pointer-events: none;
      font-size: 8rem;
      font-weight: 900;
      white-space: nowrap;
      color: #000;
      z-index: 0;
    }

    .hologram-overlay {
      background: linear-gradient(135deg, transparent 40%, rgba(255, 255, 255, 0.2) 50%, transparent 60%);
      background-size: 200% 200%;
      animation: hologram 3s infinite linear;
    }

    @keyframes hologram {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    /* Live feed blinking dot */
    .blink-red { animation: blink-red 1.5s infinite; }
    @keyframes blink-red {
      0% { opacity: 1; }
      50% { opacity: 0.4; }
      100% { opacity: 1; }
    }
  </style>
</head>

<body class="bg-gray-50 text-gray-800 antialiased selection:bg-green-200 selection:text-green-900">
  <div id="app" class="min-h-screen flex flex-col"></div>

  <script>
    (function() {
      // --- Assets ---
      const ASSETS = {
        coatOfArms: "https://upload.wikimedia.org/wikipedia/commons/thumb/b/bc/Coat_of_arms_of_Nigeria.svg/1200px-Coat_of_arms_of_Nigeria.svg.png",
        // miningLogo: "https://cdn-icons-png.flaticon.com/512/2592/2592175.png", // Old logo
        miningLogo: "https://yobemdcl.com/images/header/Logo.jpeg", // New requested logo
        dashBg: "https://images.unsplash.com/photo-1576082989508-e16109968803?q=80&w=2070&auto=format&fit=crop"
      };

      // --- Translations ---
      const translations = {
        en: {
          appTitle: "Yobe State Mining Company",
          subtitle: "Regulating & Empowering Mining Activities",
          welcome: "Welcome",
          start: "Start Here",
          portalEntry: "Enter Portal",
          adminLogin: "Staff Login",
          home: "Home",
          services: "Services",
          contact: "Contact",
          digitalSuite: "Digital Mining Suite",

          applyLicense: "Apply for License",
          registerArtisan: "Register as Artisan",
          idCard: "Get Miner ID Card",
          renew: "Renew Papers",
          
          formName: "Full Name",
          formCompany: "Company Name",
          formRC: "RC Number",
          formPhone: "Phone Number",
          formLocation: "Mining Location / LGA",
          formMineral: "Mineral Type",
          formPhoto: "Upload Photo",
          formCAC: "CAC Certificate",
          
          submit: "Submit Application",
          processing: "Processing...",
          success: "Successful!",
          downloadID: "Download ID Card",
          downloadCert: "Download Certificate",
          back: "Back",
          
          companySuffixError: "Company name must end with LTD, Limited, PLC, Enterprise, LLC, Venture, or Company.",
          phoneError: "Phone number must be exactly 11 digits.",
          required: "This field is required.",
          
          dashboard: "Executive Dashboard",
          mdDashboard: "MD Command Center",
          logout: "Logout",
          
          dsTitle: "Digital Mining Suite",
          dsSub: "Exploration, extraction, logistics, data intelligence, and compliance — unified.",
          dsExplore: "Exploration & GIS",
          dsExtract: "Extraction & Fleet",
          dsLogistics: "Logistics & Supply Chain",
          dsData: "Data Management",
          dsCompliance: "Compliance Monitor",
          
          footerDesc: "Official platform for regulating mining activities within Yobe State.",
          quickLinks: "Quick Links",
          contactUs: "Contact Us"
        },
        ha: {
          appTitle: "Kamfanin Hakar Ma'adinai na Jihar Yobe",
          subtitle: "Rungumar Ayyukan Hakar Ma'adinai",
          welcome: "Barka da zuwa",
          start: "Fara Anan",
          portalEntry: "Shiga Shafin",
          adminLogin: "Shiga na Ma'aikata",
          home: "Gida",
          services: "Ayyuka",
          contact: "Tuntube Mu",
          digitalSuite: "Tsarin Dijital na Ma'adinai",

          applyLicense: "Nemi Lasisi",
          registerArtisan: "Yi Rajistar 'Yan Haka",
          idCard: "Karbi Katin Shaida",
          renew: "Sabunta Takardu",

          formName: "Cikakken Suna",
          formCompany: "Sunan Kamfani",
          formRC: "Lambar RC",
          formPhone: "Lambar Waya",
          formLocation: "Wurin Haka / Karamar Hukuma",
          formMineral: "Nau'in Ma'adani",
          formPhoto: "Saka Hoto",
          formCAC: "Takardar CAC",

          submit: "Aika Bukata",
          processing: "Ana Aiki...",
          success: "An Yi Nasara!",
          downloadID: "Sauke Katin ID",
          downloadCert: "Sauke Takardar Lasisi",
          back: "Baya",

          companySuffixError: "Sunan kamfani dole ya kare da LTD, Limited, PLC, da sauransu.",
          phoneError: "Lambar waya dole ta kasance lamba 11.",
          required: "Ana bukatar wannan.",

          dashboard: "Dashboard na Shugabanni",
          mdDashboard: "Cibiyar MD",
          logout: "Fita",
          
          dsTitle: "Tsarin Dijital na Ma'adinai",
          dsSub: "Bincike, hakowa, jigila, bayanai, da bin doka — a wuri guda.",
          dsExplore: "Bincike & Taswira",
          dsExtract: "Hakowa & Na'urori",
          dsLogistics: "Jigila & Sarkar Kaya",
          dsData: "Sarrafa Bayanai",
          dsCompliance: "Sa Ido na Doka",
          
          footerDesc: "Shafin hukuma na kula da ayyukan hakar ma'adinai a Jihar Yobe.",
          quickLinks: "Hanyoyi Masu Sauki",
          contactUs: "Tuntube Mu"
        }
      };

      const LGAs = ["Damaturu","Potiskum","Nguru","Gashua","Geidam","Buni Yadi","Fika","Nangere", "Jakusko", "Bade", "Bursari", "Fune", "Gulani", "Gujba", "Karasuwa", "Machina", "Tarmuwa", "Yusufari"];

      // --- Helpers ---
      const iso = (d) => new Date(d).toISOString().split('T')[0];
      const now = () => new Date();
      const addDays = (days) => { const d = new Date(); d.setDate(d.getDate() + days); return d; };
      const addYears = (years) => { const d = new Date(); d.setFullYear(d.getFullYear() + years); return d; };
      const formatDate = (date) => new Date(date).toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });

      // --- State Management ---
      window.state = {
        lang: "en",
        view: "landing", 
        currentUserRole: null, 
        isLoading: false,
        error: null,
        adminSearch: "",
        applications: [
          { id: 101, name: "Ibrahim Musa", type: "Artisan", location: "Damaturu", mineral: "Gold", date: "2023-10-24", status: "Pending", photoURL: null, issueDate: null, expiryDate: null, rcNumber: null, flags: [] },
          { id: 102, name: "Yobe Gold Corp LTD", type: "License", location: "Fika", mineral: "Gypsum", rcNumber: "RC44211", date: "2023-10-25", status: "Pending", photoURL: null, issueDate: null, expiryDate: null, flags: [] },
          { id: 103, name: "Fatima Sani", type: "Artisan", location: "Nguru", mineral: "Kaolin", date: "2023-10-23", status: "Approved", photoURL: null, issueDate: iso(addDays(-90)), expiryDate: iso(addDays(275)), rcNumber: null, flags: [] },
          { id: 104, name: "Desert Sands Ltd", type: "License", location: "Geidam", mineral: "Limestone", rcNumber: "RC99882", date: "2023-10-22", status: "Approved", photoURL: null, issueDate: iso(addDays(-420)), expiryDate: iso(addDays(-20)), flags: [] },
          { id: 105, name: "Aliyu Bello", type: "Artisan", location: "Potiskum", mineral: "Gold", date: "2023-10-26", status: "Pending", photoURL: null, issueDate: null, expiryDate: null, rcNumber: null, flags: [] },
        ],
        previewAppId: null,
        timeString: new Date().toLocaleTimeString(),
        dsTab: "explore",
        complianceCases: [
          { id: "C-001", severity: "High", title: "Expired license detected", detail: "Desert Sands Ltd (RC99882) has an expired license.", createdAt: iso(addDays(-2)), resolved: false },
          { id: "C-002", severity: "Medium", title: "Unregistered machinery", detail: "Heavy equipment in Zone 4 not linked to approved operator.", createdAt: iso(addDays(-1)), resolved: false },
        ],
        dataOps: { status: "OK", lastSync: new Date(Date.now() - 1000*60*18), recordsToday: 18421, ingestRatePerMin: 420, anomaliesToday: 6 },
        ops: {
          exploration: { activeMissions: 12, gisLayers: 19, drillTargets: 7, samplesToday: 148 },
          extraction:  { activeSites: 6, equipmentOnline: 83, equipmentOffline: 9, tonnageToday: 1240 },
          logistics:   { shipmentsInTransit: 31, deliveredToday: 18, fleetOnline: 42, fleetIdle: 7 }
        },
        formData: { name: "", companyName: "", rcNumber: "", phone: "", lga: LGAs[0], mineral: "Gypsum", photoURL: null, cacName: "" },
        generatedId: "", expiryDate: "", issueDate: ""
      };

      // Interval for live clock
      setInterval(() => {
        state.timeString = new Date().toLocaleTimeString();
        const timeEls = document.querySelectorAll('.live-time');
        timeEls.forEach(el => el.innerText = state.timeString);
      }, 1000);

      // Interval to refresh CCTV to simulate "Autoplay" live feed
      setInterval(() => {
        const cctvImages = document.querySelectorAll('.cctv-live-img');
        cctvImages.forEach(img => {
            const originalSrc = img.getAttribute('data-original-src');
            // Add a timestamp to force reload
            img.src = `${originalSrc}?t=${Date.now()}`;
        });
      }, 5000); // Refresh every 5 seconds

      const state = window.state;
      const t = (key) => translations[state.lang][key] || key;
      const app = document.getElementById("app");

      // --- View Utils ---
      const setView = (view) => {
        state.view = view;
        state.error = null;
        window.scrollTo({ top: 0, behavior: 'instant' });
        render();
      };
      window.setView = setView; 

      window.toggleLang = function() {
        state.lang = state.lang === "en" ? "ha" : "en";
        render();
      };

      window.scrollToBottom = function() {
        window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
      }

      window.setDsTab = function (tab) {
        state.dsTab = tab;
        render();
      };

      // --- Form Handlers ---
      window.handlePhotoUpload = function(event) {
        const file = event.target.files[0];
        if (file) {
          state.formData.photoURL = URL.createObjectURL(file);
          render(); 
        }
      };

      window.handleCACUpload = function(event) {
        const file = event.target.files[0];
        if (file) {
          state.formData.cacName = file.name;
          render();
        }
      };

      window.handleAdminSearch = function(event) {
        state.adminSearch = event.target.value;
        render();
      }
      
      window.viewApplication = function(id) {
        state.previewAppId = id;
        render(); 
      }

      window.closePreview = function() {
        state.previewAppId = null;
        render();
      }

      window.updateStatus = function(id, newStatus) {
        const app = state.applications.find(a => a.id === id);
        if (app) {
          app.status = newStatus;
          if (newStatus === "Approved") {
            app.issueDate = app.issueDate || iso(now());
            app.expiryDate = app.expiryDate || iso(addYears(1));
          }
          render();
        }
      }

      // --- Validation ---
      function validateForm(type) {
        const { name, companyName, rcNumber, phone, photoURL, cacName } = state.formData;
        const errors = [];

        // Enhanced phone validation
        const cleanPhone = phone.replace(/\D/g, '');
        if (cleanPhone.length !== 11) {
          errors.push(t("phoneError"));
        }

        if (type === 'artisan') {
          if (!name.trim()) errors.push(t("required"));
          if (!photoURL) errors.push("Passport photo is required for ID card security.");
        } 
        else if (type === 'license') {
          const validSuffixes = ['ltd', 'limited', 'plc', 'enterprise', 'llc', 'venture', 'company', 'ltd.', 'inc'];
          const lowerName = companyName.toLowerCase().trim();
          const hasValidSuffix = validSuffixes.some(suffix => lowerName.endsWith(suffix));
          
          if (!companyName.trim() || !hasValidSuffix) {
            errors.push(t("companySuffixError"));
          }
          if (!rcNumber.trim()) errors.push(t("required"));
          if (!cacName) errors.push("CAC Certificate is required.");
        }

        return errors;
      }

      window.submitForm = function(type) {
        const errors = validateForm(type);
        if (errors.length > 0) {
          state.error = errors.join(" | ");
          render();
          return;
        }

        state.isLoading = true;
        render();

        setTimeout(() => {
          state.isLoading = false;
          state.generatedId = type === 'artisan' 
            ? `ART-${Math.floor(100000 + Math.random() * 900000)}` 
            : `YSM-${state.formData.rcNumber}`;
          state.issueDate = new Date();
          state.expiryDate = addYears(1);
          
          const newApp = {
             id: Math.floor(Math.random() * 10000),
             name: type === 'artisan' ? state.formData.name : state.formData.companyName,
             type: type === 'artisan' ? 'Artisan' : 'License',
             location: state.formData.lga,
             mineral: state.formData.mineral,
             date: iso(now()),
             status: "Pending",
             photoURL: state.formData.photoURL,
             rcNumber: type === 'license' ? state.formData.rcNumber : null,
             issueDate: null,
             expiryDate: null,
             flags: []
          };
          state.applications.unshift(newApp);

          setView("success");
        }, 1500);
      };

      window.handleAdminLogin = function(e) {
        e.preventDefault();
        const input = document.getElementById("admin-pin");
        const btn = document.getElementById("admin-submit");
        if (!input.value) return;
        if(btn) btn.innerHTML = t("processing");
        setTimeout(() => {
          if (input.value === "3333") {
             state.currentUserRole = 'md';
             setView('md-dashboard');
          } else {
             state.currentUserRole = 'staff';
             setView('admin-dashboard');
          }
        }, 1000);
      }
      
      window.logout = function() {
        state.currentUserRole = null;
        setView('landing');
      }

      window.downloadElement = async function(elementId, fileName) {
        const element = document.getElementById(elementId);
        if (!element) return;
        try {
          const canvas = await html2canvas(element, { scale: 2, useCORS: true, backgroundColor: null });
          const link = document.createElement('a');
          link.download = `${fileName}.png`;
          link.href = canvas.toDataURL();
          link.click();
        } catch (err) {
          console.error("Download failed", err);
          alert("Could not generate image. Please try again.");
        }
      };

      // --- Helpers ---
      function Icon(name, className="w-5 h-5") {
        return `<i data-lucide="${name}" class="${className}"></i>`;
      }

      function renderInput(label, id, type="text", placeholder="", value="", oninput="", maxlength=null) {
        return `
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">${label}</label>
            <input type="${type}" id="${id}" 
              class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:outline-none transition-all"
              placeholder="${placeholder}"
              value="${value}"
              ${maxlength ? `maxlength="${maxlength}"` : ''}
              oninput="${oninput}"
            >
          </div>
        `;
      }

      function renderSelect(label, id, options, selectedValue, onchange) {
        return `
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">${label}</label>
            <div class="relative">
              <select id="${id}" onchange="${onchange}"
                class="w-full pl-4 pr-10 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:outline-none appearance-none"
              >
                ${options.map(opt => `<option value="${opt}" ${opt === selectedValue ? 'selected' : ''}>${opt}</option>`).join('')}
              </select>
              <div class="absolute right-3 top-3.5 pointer-events-none text-gray-400">
                ${Icon("chevron-down", "w-5 h-5")}
              </div>
            </div>
          </div>
        `;
      }

      function renderHeader() {
        return `
          <header class="bg-gradient-to-r from-emerald-900 to-emerald-700 text-white p-4 shadow-lg sticky top-0 z-50">
            <div class="flex justify-between items-center max-w-6xl mx-auto">
              <div class="flex items-center space-x-3 cursor-pointer group" onclick="setView('landing')">
                <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-md border-2 border-white group-hover:scale-105 transition-transform overflow-hidden">
                  <img src="${ASSETS.miningLogo}" class="w-full h-full object-cover" alt="Yobe Mining Logo">
                </div>
                <div>
                  <h1 class="font-bold text-sm md:text-lg leading-tight tracking-wide">${t("appTitle")}</h1>
                  <p class="text-[10px] md:text-xs text-emerald-200 uppercase tracking-wider hidden md:block">${t("subtitle")}</p>
                </div>
              </div>
              <div class="flex items-center space-x-4">
                <nav class="hidden md:flex space-x-6 text-sm font-medium text-emerald-100">
                  <button onclick="setView('landing')" class="hover:text-white hover:underline">${t("home")}</button>
                  <button onclick="setView('miner-portal')" class="hover:text-white hover:underline">${t("services")}</button>
                  <button onclick="setView('digital-suite')" class="hover:text-white hover:underline">${t("digitalSuite")}</button>
                  <button onclick="scrollToBottom()" class="hover:text-white hover:underline">${t("contact")}</button>
                </nav>
                <button onclick="toggleLang()" class="flex items-center bg-white/10 hover:bg-white/20 px-3 py-1.5 rounded-full transition-all text-xs md:text-sm font-medium border border-white/20 backdrop-blur-sm">
                  ${Icon("languages","w-4 h-4 mr-2")}
                  ${state.lang === "en" ? "HA" : "EN"}
                </button>
              </div>
            </div>
          </header>
        `;
      }

      // --- Render Functions ---
      function renderLanding() {
        return `
          <div class="animate-fade-in-up">
            <div class="relative bg-emerald-900 text-white overflow-hidden">
              <div class="absolute inset-0 bg-[url('${ASSETS.dashBg}')] bg-cover bg-center opacity-20"></div>
              <div class="absolute inset-0 bg-gradient-to-r from-emerald-900/90 to-emerald-800/80"></div>

              <div class="relative max-w-6xl mx-auto px-6 py-24 md:py-32 flex flex-col md:flex-row items-center">
                <div class="md:w-1/2 mb-10 md:mb-0">
                  <div class="inline-block px-3 py-1 bg-yellow-400 text-emerald-900 text-xs font-bold rounded-full mb-4 uppercase tracking-wider">
                    Official Portal
                  </div>
                  <h1 class="text-4xl md:text-6xl font-bold mb-6 leading-tight">
                    ${t("subtitle")}
                  </h1>
                  <p class="text-emerald-100 text-lg mb-8 max-w-lg">
                    Streamlining mining operations in Yobe State through digital innovation. Register, apply, and monitor efficiently.
                  </p>
                  <div class="flex flex-col sm:flex-row gap-4">
                    <button onclick="setView('miner-portal')" class="bg-yellow-400 text-emerald-900 px-8 py-4 rounded-xl font-bold hover:bg-yellow-300 transition-all transform hover:scale-105 shadow-lg flex items-center justify-center">
                      ${t("portalEntry")} ${Icon("arrow-right","ml-2 w-5 h-5")}
                    </button>
                    <button onclick="setView('digital-suite')" class="bg-white/10 border border-white/20 text-white px-8 py-4 rounded-xl font-bold hover:bg-white/20 transition-all flex items-center justify-center">
                      ${Icon("layout-dashboard","mr-2 w-5 h-5")} ${t("digitalSuite")}
                    </button>
                    <button onclick="setView('admin-login')" class="bg-transparent border-2 border-white/30 text-white px-8 py-4 rounded-xl font-bold hover:bg-white/10 transition-all flex items-center justify-center">
                      ${Icon("lock","mr-2 w-4 h-4")} ${t("adminLogin")}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
      }

      function renderArtisanForm() {
        return `
          <div class="max-w-xl w-full mx-auto px-4 py-8 animate-slide-in-right">
            <button onclick="setView('miner-portal')" class="text-gray-500 mb-4 flex items-center hover:text-gray-900 transition">${Icon("arrow-left", "w-5 h-5 mr-1")} ${t("back")}</button>
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
              <div class="bg-yellow-500 p-4 text-emerald-900">
                <h2 class="text-xl font-bold flex items-center gap-2">${Icon("pickaxe")} ${t("registerArtisan")}</h2>
              </div>
              <div class="p-6">
                ${state.error ? `<div class="bg-red-50 text-red-600 p-3 rounded-lg text-sm mb-4 border border-red-100">${state.error}</div>` : ''}
                ${renderInput(t("formName"), "inp-name", "text", "Musa Ibrahim", state.formData.name, "state.formData.name = this.value")}
                ${renderInput(t("formPhone"), "inp-phone", "tel", "08012345678", state.formData.phone, "state.formData.phone = this.value.replace(/\\D/g, '').slice(0, 11)", "11")}
                ${renderSelect(t("formLocation"), "sel-lga", LGAs, state.formData.lga, "state.formData.lga = this.value")}
                ${renderSelect(t("formMineral"), "sel-mineral", ["Gypsum", "Limestone", "Gold", "Diatomite", "Kaolin", "Potash"], state.formData.mineral, "state.formData.mineral = this.value")}
                <div class="mb-6">
                  <label class="block text-sm font-medium text-gray-700 mb-1">${t("formPhoto")}</label>
                  <div class="flex items-center gap-4">
                    <label class="cursor-pointer bg-gray-100 hover:bg-gray-200 text-gray-600 px-4 py-3 rounded-xl border border-dashed border-gray-400 flex items-center gap-2 transition w-full justify-center">
                      ${Icon("camera", "w-5 h-5")} Upload Photo
                      <input type="file" accept="image/*" class="hidden" onchange="handlePhotoUpload(event)">
                    </label>
                    ${state.formData.photoURL ? `<img src="${state.formData.photoURL}" class="w-12 h-12 rounded-full object-cover border-2 border-yellow-500 shadow-sm">` : ''}
                  </div>
                </div>
                <button onclick="submitForm('artisan')" class="w-full bg-emerald-800 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-emerald-900 transition flex justify-center items-center">
                  ${state.isLoading ? Icon("loader-2", "animate-spin mr-2") : ""}
                  ${state.isLoading ? t("processing") : t("submit")}
                </button>
              </div>
            </div>
          </div>
        `;
      }

      function renderLicenseForm() {
        return `
          <div class="max-w-xl w-full mx-auto px-4 py-8 animate-slide-in-right">
            <button onclick="setView('miner-portal')" class="text-gray-500 mb-4 flex items-center hover:text-gray-900 transition">${Icon("arrow-left", "w-5 h-5 mr-1")} ${t("back")}</button>
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
              <div class="bg-emerald-700 p-4 text-white">
                <h2 class="text-xl font-bold flex items-center gap-2">${Icon("building-2")} ${t("applyLicense")}</h2>
              </div>
              <div class="p-6">
                ${state.error ? `<div class="bg-red-50 text-red-600 p-3 rounded-lg text-sm mb-4 border border-red-100">${state.error}</div>` : ''}
                ${renderInput(t("formCompany"), "inp-comp", "text", "e.g. Desert Mining Ltd", state.formData.companyName, "state.formData.companyName = this.value")}
                ${renderInput(t("formRC"), "inp-rc", "text", "RC123456", state.formData.rcNumber, "state.formData.rcNumber = this.value")}
                ${renderInput(t("formPhone"), "inp-phone", "tel", "08012345678", state.formData.phone, "state.formData.phone = this.value.replace(/\\D/g, '').slice(0, 11)", "11")}
                ${renderSelect(t("formLocation"), "sel-lga", LGAs, state.formData.lga, "state.formData.lga = this.value")}
                ${renderSelect(t("formMineral"), "sel-mineral", ["Gypsum", "Limestone", "Gold", "Diatomite", "Kaolin", "Potash"], state.formData.mineral, "state.formData.mineral = this.value")}
                <div class="mb-6">
                  <label class="block text-sm font-medium text-gray-700 mb-1">${t("formCAC")}</label>
                  <label class="cursor-pointer bg-emerald-50 hover:bg-emerald-100 text-emerald-700 px-4 py-3 rounded-xl border border-dashed border-emerald-300 flex flex-col items-center gap-2 transition text-center">
                    ${Icon("upload-cloud", "w-8 h-8")}
                    <span class="text-sm font-medium">${state.formData.cacName || "Click to upload PDF/Image"}</span>
                    <input type="file" accept="image/*,.pdf" class="hidden" onchange="handleCACUpload(event)">
                  </label>
                </div>
                <button onclick="submitForm('license')" class="w-full bg-emerald-800 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-emerald-900 transition flex justify-center items-center">
                  ${state.isLoading ? Icon("loader-2", "animate-spin mr-2") : ""}
                  ${state.isLoading ? t("processing") : t("submit")}
                </button>
              </div>
            </div>
          </div>
        `;
      }

      function renderSuccess() {
        const isArtisan = state.generatedId.startsWith('ART');
        const qrData = encodeURIComponent(`ID:${state.generatedId}|Name:${state.formData.name || state.formData.companyName}|Valid:${state.expiryDate}`);
        const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${qrData}`;
        const logoUrl = ASSETS.miningLogo;

        return `
          <div class="flex-grow flex flex-col items-center py-10 px-4 bg-gray-100">
            <div class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mb-4 animate-bounce">
              ${Icon("check-circle", "w-10 h-10")}
            </div>
            <h2 class="text-2xl font-bold text-emerald-900 mb-8">${t("success")}</h2>

            <div class="w-full max-w-2xl mb-8 flex justify-center">
              ${isArtisan ? `
                <div id="download-target" class="relative w-[340px] h-[540px] bg-gradient-to-br from-green-800 to-green-950 rounded-2xl shadow-2xl overflow-hidden text-white flex flex-col items-center pt-8 pb-4 px-6 border-2 border-yellow-500/50">
                  <div class="hologram-overlay absolute inset-0 pointer-events-none z-20"></div>
                  <div class="security-pattern absolute inset-0 z-0 opacity-20"></div>
                  <div class="watermark-ghost absolute inset-0 flex items-center justify-center opacity-5 pointer-events-none">YOBE</div>

                  <div class="flex flex-col items-center mb-6 z-10 text-center relative">
                    <img src="${ASSETS.coatOfArms}" class="w-12 h-12 object-contain mb-2 drop-shadow-md">
                    <h3 class="text-[10px] uppercase tracking-widest text-green-200">Federal Republic of Nigeria</h3>
                    <h1 class="text-lg font-bold font-serif text-yellow-400">YOBE STATE GOVERNMENT</h1>
                    <div class="text-[10px] bg-yellow-500 text-black px-2 py-0.5 rounded font-bold mt-1 shadow-lg">CERTIFIED ARTISAN MINER</div>
                  </div>
                  <div class="w-32 h-32 rounded-full border-4 border-yellow-400 overflow-hidden shadow-lg mb-4 z-10 bg-gray-300 relative">
                    <img src="${state.formData.photoURL || ASSETS.miningLogo}" class="w-full h-full object-cover">
                  </div>
                  <div class="text-center z-10 w-full space-y-2">
                    <div>
                      <h2 class="text-xl font-bold text-white truncate drop-shadow-md">${state.formData.name}</h2>
                      <p class="text-xs text-green-300 uppercase font-bold">${state.formData.lga} LGA</p>
                    </div>
                    <div class="bg-white/10 rounded-lg p-2 flex justify-between items-center text-xs border border-white/20 mt-2 backdrop-blur-sm">
                      <div class="text-left">
                        <div class="text-green-300 text-[10px]">Mineral</div>
                        <div class="font-bold text-yellow-300">${state.formData.mineral}</div>
                      </div>
                       <div class="text-right">
                        <div class="text-green-300 text-[10px]">ID Number</div>
                        <div class="font-mono font-bold text-white tracking-widest">${state.generatedId}</div>
                      </div>
                    </div>
                  </div>
                  <div class="mt-auto z-10 w-full flex justify-between items-end">
                     <div class="text-left">
                       <div class="text-[10px] text-green-400">Expires</div>
                       <div class="text-sm font-bold">${formatDate(state.expiryDate)}</div>
                     </div>
                     <div class="bg-white p-1 rounded shadow-lg">
                       <img src="${qrUrl}" class="w-14 h-14">
                     </div>
                  </div>
                </div>
              ` : `
                 <div id="download-target" class="relative w-[800px] bg-[#fcfbf7] text-gray-800 p-10 border-[10px] border-double border-emerald-900 shadow-2xl flex flex-col items-center font-serif aspect-[1.4/1] overflow-hidden">
                    <div class="guilloche-border absolute inset-4 pointer-events-none opacity-50"></div>
                    <div class="absolute inset-0 flex items-center justify-center opacity-[0.03] pointer-events-none">
                        <img src="${logoUrl}" class="w-[500px] h-[500px] object-contain grayscale">
                    </div>
                    <div class="absolute inset-0 flex items-center justify-center opacity-[0.04] pointer-events-none transform -rotate-45">
                        <span class="text-9xl font-bold">COPY</span>
                    </div>

                    <div class="w-full flex justify-between items-start border-b-2 border-emerald-800 pb-4 mb-8 z-10">
                      <img src="${ASSETS.coatOfArms}" class="w-20">
                      <div class="text-center">
                        <h2 class="text-sm uppercase tracking-[0.2em] text-gray-500">Federal Republic of Nigeria</h2>
                        <h1 class="text-3xl font-bold text-emerald-900 mt-1">YOBE STATE GOVERNMENT</h1>
                        <div class="text-emerald-700 font-bold italic mt-1">Ministry of Mineral Resources</div>
                      </div>
                       <div class="w-20 h-20 bg-white rounded-full flex items-center justify-center border-2 border-emerald-600 overflow-hidden p-2">
                          <img src="${logoUrl}" class="w-full h-full object-contain">
                       </div>
                    </div>
                    <h1 class="text-4xl font-bold text-yellow-600 mb-6 z-10 underline decoration-double underline-offset-4 tracking-wide">${t("certTitle")}</h1>
                    <div class="text-center max-w-2xl text-lg leading-relaxed z-10 mb-8 space-y-4">
                      <p>${t("certBody")}</p>
                      <div class="my-6 py-4 border-t border-b border-gray-300 bg-emerald-50/50">
                         <div class="text-3xl font-bold text-emerald-900 mb-1 uppercase tracking-tight">${state.formData.companyName}</div>
                         <div class="font-mono text-gray-500 text-sm tracking-widest">RC: ${state.formData.rcNumber}</div>
                      </div>
                      <p>Has been granted a license for <strong class="text-emerald-800 underline">${state.formData.mineral}</strong> mining operations in <strong class="text-emerald-800 underline">${state.formData.lga}</strong> LGA.</p>
                    </div>
                    <div class="w-full mt-auto grid grid-cols-3 gap-8 items-end z-10">
                      <div class="text-center">
                        <img src="${qrUrl}" class="w-24 h-24 mx-auto border p-1 bg-white mb-2 shadow-sm">
                        <div class="text-xs text-gray-400 font-sans">Scan to Verify</div>
                      </div>
                      <div class="text-center font-sans">
                        <div class="text-xs text-gray-500 uppercase mb-1">${t("validUntil")}</div>
                        <div class="text-xl font-bold text-red-600">${formatDate(state.expiryDate)}</div>
                      </div>
                      <div class="text-center">
                         <div class="w-32 h-12 mx-auto mb-2 relative">
                           <div class="absolute inset-0 flex items-center justify-center font-cursive text-2xl text-blue-900 rotate-[-10deg] opacity-80" style="font-family: cursive;">Signed</div>
                         </div>
                         <div class="border-t border-gray-800 pt-1 font-bold text-sm uppercase">${t("signature")}</div>
                      </div>
                    </div>
                 </div>
              `}
            </div>

            <div class="flex gap-4">
              <button onclick="downloadElement('download-target', '${isArtisan ? 'MinerID' : 'MiningLicense'}')" class="bg-gray-900 hover:bg-black text-white px-6 py-3 rounded-xl font-bold shadow-lg transition flex items-center gap-2">
                ${Icon("download")} ${isArtisan ? t("downloadID") : t("downloadCert")}
              </button>
              <button onclick="setView('miner-portal')" class="bg-white border border-gray-300 text-gray-700 px-6 py-3 rounded-xl font-bold shadow-sm hover:bg-gray-50 transition">
                ${t("back")}
              </button>
            </div>
          </div>
        `;
      }

      function renderMDDashboard() {
         const pipeline = state.dataOps.status;
         const pipelineColor = pipeline === "OK" ? "text-green-500" : "text-red-500";
         
         // CCTV Sources (Static Images used as "feeds")
         const feeds = [
           { url: "https://embed.skylinewebcams.com/img/992.jpg", name: "TSAVO EAST (KENYA)" },
           { url: "https://embed.skylinewebcams.com/img/165.jpg", name: "ROME PANTHEON" },
           { url: "https://embed.skylinewebcams.com/img/607.jpg", name: "PIAZZA VENEZIA" },
           { url: "https://embed.skylinewebcams.com/img/4309.jpg", name: "DIANI BEACH" }
         ];

         return `
           <div class="min-h-screen bg-gray-50 text-gray-800 pb-12 animate-fade-in-up font-sans">
              <div class="bg-white border-b border-gray-200 px-8 py-4 flex justify-between items-center sticky top-0 z-50 shadow-sm">
                 <div class="flex items-center">
                    <div class="p-2 bg-emerald-100 rounded-lg mr-3">
                       ${Icon("shield", "w-6 h-6 text-emerald-700")}
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-gray-900 tracking-tight">${t("mdDashboard")}</h2>
                        <div class="text-xs text-gray-500 flex items-center gap-1">
                          <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                          System Operational
                        </div>
                    </div>
                 </div>
                 <div class="flex items-center space-x-6">
                    <button onclick="setView('digital-suite')" class="hidden md:flex items-center gap-2 text-xs bg-gray-100 border border-gray-200 px-3 py-2 rounded-xl hover:bg-gray-200 transition text-gray-600 font-bold">
                       ${Icon("layout-dashboard","w-4 h-4")} ${t("digitalSuite")}
                    </button>
                    <div class="text-right hidden md:block">
                        <div class="text-xs text-gray-400 uppercase font-bold tracking-wider">Local Time</div>
                        <div class="text-lg font-mono font-bold text-gray-800 live-time">${state.timeString}</div>
                    </div>
                    <button onclick="logout()" class="flex items-center bg-gray-100 hover:bg-red-50 text-gray-600 hover:text-red-600 px-4 py-2 rounded-xl transition-colors text-sm font-bold border border-gray-200">
                       ${Icon("log-out","w-4 h-4 mr-2")} ${t("logout")}
                    </button>
                 </div>
              </div>

              <div class="max-w-[1600px] mx-auto p-8">
                 <!-- Stats Row -->
                 <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                       <div class="flex justify-between items-start mb-4">
                          <div>
                             <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Total Revenue</p>
                             <h3 class="text-3xl font-bold text-gray-900 mt-1">₦ 84.5M</h3>
                          </div>
                          <div class="p-3 bg-green-50 text-green-600 rounded-xl">${Icon("banknote", "w-6 h-6")}</div>
                       </div>
                       <p class="text-xs text-green-600 mt-2 font-medium">+14% vs last month</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                       <div class="flex justify-between items-start mb-4">
                          <div>
                             <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Compliance Score</p>
                             <h3 class="text-3xl font-bold text-gray-900 mt-1">98%</h3>
                          </div>
                          <div class="p-3 bg-yellow-50 text-yellow-600 rounded-xl">${Icon("shield-check", "w-6 h-6")}</div>
                       </div>
                       <p class="text-xs text-gray-500 mt-2 font-medium">3 active flags</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                       <div class="flex justify-between items-start mb-4">
                          <div>
                             <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Active Sites</p>
                             <h3 class="text-3xl font-bold text-gray-900 mt-1">${state.ops.extraction.activeSites}</h3>
                          </div>
                          <div class="p-3 bg-blue-50 text-blue-600 rounded-xl">${Icon("map-pin", "w-6 h-6")}</div>
                       </div>
                       <p class="text-xs text-blue-600 mt-2 font-medium">12 new sites added</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                       <div class="flex justify-between items-start mb-4">
                          <div>
                             <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Data Pipeline</p>
                             <h3 class="text-3xl font-bold text-gray-900 mt-1">${pipeline}</h3>
                          </div>
                          <div class="p-3 bg-purple-50 text-purple-600 rounded-xl">${Icon("database", "w-6 h-6")}</div>
                       </div>
                       <p class="text-xs ${pipelineColor} mt-2 font-medium">${state.dataOps.ingestRatePerMin} events/min</p>
                    </div>
                 </div>

                 <div class="grid grid-cols-12 gap-8">
                    <!-- LEFT COLUMN: MAP -->
                    <div class="col-span-12 lg:col-span-8 space-y-8">
                       <!-- LIVE GOOGLE MAP -->
                       <div class="bg-white rounded-2xl overflow-hidden border border-gray-100 shadow-md relative h-[600px]">
                          <div class="absolute top-4 left-4 z-10 bg-white/90 backdrop-blur px-4 py-2 rounded-lg text-xs border border-gray-200 shadow-sm flex items-center gap-2">
                             <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                             <span class="font-bold text-gray-700">LIVE SATELLITE: YOBE STATE</span>
                          </div>
                          <iframe 
                             width="100%" 
                             height="100%" 
                             frameborder="0" 
                             style="border:0" 
                             src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1005999.578656606!2d11.3!3d12.0!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x11049f0b12345678%3A0x1234567890abcdef!2sYobe%20State!5e0!3m2!1sen!2sng!4v1610000000000!5m2!1sen!2sng" 
                             allowfullscreen>
                          </iframe>
                       </div>
                    </div>

                    <!-- RIGHT COLUMN: CCTV -->
                    <div class="col-span-12 lg:col-span-4 space-y-6">
                       <!-- LIVE CCTV FEED -->
                       <div class="bg-gray-900 rounded-2xl overflow-hidden shadow-xl border border-gray-800">
                          <div class="bg-gray-800 px-4 py-3 border-b border-gray-700 flex justify-between items-center">
                             <span class="text-xs font-bold text-gray-300 flex items-center gap-2">
                                ${Icon("camera", "w-3 h-3")} SITE SURVEILLANCE
                             </span>
                             <div class="flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-red-500 blink-red"></span>
                                <span class="text-[10px] font-mono text-red-400">REC</span>
                             </div>
                          </div>
                          
                          <div class="grid grid-cols-2 gap-0.5 bg-black p-0.5">
                             ${feeds.map(feed => `
                               <div class="relative aspect-video bg-gray-800 group overflow-hidden">
                                  <img 
                                    src="${feed.url}" 
                                    data-original-src="${feed.url}"
                                    class="cctv-live-img w-full h-full object-cover opacity-90 group-hover:opacity-100 transition duration-500"
                                  />
                                  <div class="absolute top-2 left-2 text-[8px] bg-black/60 text-white px-1.5 py-0.5 rounded backdrop-blur font-mono">${feed.name}</div>
                                  <div class="absolute bottom-2 right-2 text-[8px] font-mono text-white/80 live-time">${state.timeString}</div>
                                  <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                                      <div class="w-8 h-8 rounded-full bg-white/20 backdrop-blur flex items-center justify-center">
                                        <div class="w-0 h-0 border-t-[6px] border-t-transparent border-l-[10px] border-l-white border-b-[6px] border-b-transparent ml-1"></div>
                                      </div>
                                  </div>
                               </div>
                             `).join('')}
                          </div>
                          <div class="px-4 py-2 bg-gray-800 text-[10px] text-gray-400 font-mono text-center">
                             Feeds auto-refreshing every 5s | Secure Connection
                          </div>
                       </div>

                       <!-- COMPLIANCE WIDGET -->
                       <div class="bg-white rounded-2xl border border-gray-100 shadow-sm p-6">
                          <h4 class="font-bold text-gray-800 mb-4 flex items-center justify-between">
                             <div class="flex items-center gap-2">${Icon("bell-ring","w-4 h-4 text-yellow-500")} Auto Flags</div>
                             <span class="text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded-full">3 active</span>
                          </h4>
                          <div class="space-y-3">
                             <div class="flex gap-3 items-start border-l-2 border-red-500 pl-3 py-1">
                                <div class="text-[10px] text-gray-400 font-mono mt-0.5">Now</div>
                                <div>
                                   <div class="text-xs font-bold text-gray-800">Expired License</div>
                                   <div class="text-[10px] text-gray-500">Desert Sands Ltd (RC99882)</div>
                                </div>
                             </div>
                             <div class="flex gap-3 items-start border-l-2 border-yellow-500 pl-3 py-1">
                                <div class="text-[10px] text-gray-400 font-mono mt-0.5">2m ago</div>
                                <div>
                                   <div class="text-xs font-bold text-gray-800">Unregistered Machine</div>
                                   <div class="text-[10px] text-gray-500">Excavator in Zone 4</div>
                                </div>
                             </div>
                          </div>
                       </div>
                    </div>
                 </div>
              </div>
           </div>
        `;
      }

      function renderDigitalSuite() {
         const activeTab = state.dsTab;
         
         // Demo Content for each tab (Access Fixed/Unlocked)
         const contents = {
             explore: `
                <div class="bg-white rounded-2xl border border-gray-200 shadow-sm p-6 animate-fade-in-up">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">${Icon("map", "text-emerald-600")} Geological Exploration GIS</h3>
                    <div class="bg-gray-100 rounded-xl h-64 flex items-center justify-center text-gray-400 mb-4 border border-dashed border-gray-300">
                        Interactive GIS Map Placeholder
                    </div>
                    <div class="grid grid-cols-3 gap-4 text-sm">
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <div class="text-gray-500 text-xs">Active Surveys</div>
                            <div class="font-bold text-gray-900 text-xl">12</div>
                        </div>
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <div class="text-gray-500 text-xs">Soil Samples</div>
                            <div class="font-bold text-gray-900 text-xl">1,204</div>
                        </div>
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <div class="text-gray-500 text-xs">Drill Targets</div>
                            <div class="font-bold text-gray-900 text-xl">7</div>
                        </div>
                    </div>
                </div>
             `,
             extract: `
                <div class="bg-white rounded-2xl border border-gray-200 shadow-sm p-6 animate-fade-in-up">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">${Icon("truck", "text-blue-600")} Extraction & Fleet Management</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-100">
                            <div class="flex items-center gap-3">
                                <div class="w-2 h-2 rounded-full bg-green-500"></div>
                                <div>
                                    <div class="font-bold text-sm">CAT Excavator 320</div>
                                    <div class="text-xs text-gray-500">Site: Potiskum | Fuel: 78%</div>
                                </div>
                            </div>
                            <div class="text-xs font-mono bg-green-100 text-green-700 px-2 py-1 rounded">ONLINE</div>
                        </div>
                         <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-100">
                            <div class="flex items-center gap-3">
                                <div class="w-2 h-2 rounded-full bg-red-500"></div>
                                <div>
                                    <div class="font-bold text-sm">Dump Truck DT-04</div>
                                    <div class="text-xs text-gray-500">Site: Damaturu | Maintenance Required</div>
                                </div>
                            </div>
                            <div class="text-xs font-mono bg-red-100 text-red-700 px-2 py-1 rounded">OFFLINE</div>
                        </div>
                    </div>
                </div>
             `,
             logistics: `
                <div class="bg-white rounded-2xl border border-gray-200 shadow-sm p-6 animate-fade-in-up">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">${Icon("route", "text-orange-600")} Supply Chain Logistics</h3>
                    <p class="text-gray-600 mb-4">Tracking mineral movement from extraction point to processing facilities.</p>
                    <div class="w-full bg-gray-100 rounded-full h-2 mb-6 overflow-hidden">
                        <div class="bg-orange-500 h-full w-[65%]"></div>
                    </div>
                    <div class="flex justify-between text-sm font-medium">
                        <span>Extraction (Site A)</span>
                        <span class="text-orange-600">In Transit (31 Trucks)</span>
                        <span>Processing (Zone B)</span>
                    </div>
                </div>
             `,
             data: `
                <div class="bg-white rounded-2xl border border-gray-200 shadow-sm p-6 animate-fade-in-up">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">${Icon("database", "text-purple-600")} Data Management</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="p-4 bg-purple-50 rounded-xl border border-purple-100">
                            <div class="text-purple-600 mb-2">${Icon("server", "w-6 h-6")}</div>
                            <div class="text-2xl font-bold text-gray-900">18.4k</div>
                            <div class="text-xs text-gray-500">Records Ingested Today</div>
                        </div>
                        <div class="p-4 bg-green-50 rounded-xl border border-green-100">
                            <div class="text-green-600 mb-2">${Icon("activity", "w-6 h-6")}</div>
                            <div class="text-2xl font-bold text-gray-900">99.9%</div>
                            <div class="text-xs text-gray-500">Uptime</div>
                        </div>
                    </div>
                </div>
             `,
             compliance: `
                <div class="bg-white rounded-2xl border border-gray-200 shadow-sm p-6 animate-fade-in-up">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">${Icon("shield-check", "text-red-600")} Regulatory Compliance</h3>
                     <div class="flex items-center gap-4 p-4 bg-red-50 text-red-800 rounded-xl border border-red-100 mb-4">
                        ${Icon("alert-triangle", "w-8 h-8 flex-shrink-0")}
                        <div>
                            <div class="font-bold">3 Critical Alerts</div>
                            <div class="text-xs opacity-80">Immediate attention required for expired licenses in Zone 4.</div>
                        </div>
                        <button class="ml-auto bg-red-600 text-white px-3 py-1 rounded-lg text-xs font-bold hover:bg-red-700">Resolve</button>
                    </div>
                    <div class="text-center text-sm text-gray-500">Full audit logs available in admin panel.</div>
                </div>
             `
         };

         return `
           <div class="animate-fade-in-up">
             <div class="bg-gradient-to-r from-gray-900 to-emerald-900 text-white">
               <div class="max-w-6xl mx-auto px-6 py-12">
                 <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
                   <div>
                     <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-xs font-bold uppercase tracking-wider">
                       ${Icon("sparkles","w-4 h-4")} ${t("dsTitle")}
                     </div>
                     <h2 class="text-3xl md:text-4xl font-bold mt-3">${t("dsSub")}</h2>
                   </div>
                 </div>
               </div>
             </div>

             <div class="max-w-6xl mx-auto px-6 py-8">
               <div class="flex flex-wrap gap-2 mb-6">
                 ${tabBtn("explore", t("dsExplore"), "map")}
                 ${tabBtn("extract", t("dsExtract"), "truck")}
                 ${tabBtn("logistics", t("dsLogistics"), "route")}
                 ${tabBtn("data", t("dsData"), "database")}
                 ${tabBtn("compliance", t("dsCompliance"), "shield-check")}
               </div>

               ${contents[activeTab]}
               
               <div class="mt-8 flex gap-3">
                  <button onclick="setView('miner-portal')" class="px-5 py-3 rounded-xl bg-gray-900 text-white font-bold hover:bg-black transition flex items-center gap-2">
                    ${Icon("arrow-left","w-4 h-4")} Back to Services
                  </button>
               </div>
             </div>
           </div>
         `;
      }

      function tabBtn(tab, label, icon) {
        const active = state.dsTab === tab;
        return `
          <button onclick="setDsTab('${tab}')" class="${active ? 'bg-gray-900 text-white' : 'bg-white text-gray-700 hover:bg-gray-50'} flex items-center gap-2 px-4 py-2 rounded-xl border border-gray-200 shadow-sm transition text-sm font-semibold">
            ${Icon(icon, "w-4 h-4")} ${label}
          </button>
        `;
      }

      function renderAdminLogin() {
        return `
          <div class="min-h-[70vh] flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-xl p-8 max-w-sm w-full animate-fade-in-up border border-gray-100">
              <div class="text-center mb-6">
                <div class="w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  ${Icon("lock","w-8 h-8 text-emerald-700")}
                </div>
                <h2 class="text-2xl font-bold text-gray-900">${t("adminLogin")}</h2>
                <div class="mt-2 text-xs text-gray-400">Tip: MD PIN is <span class="font-mono font-bold text-gray-700">3333</span></div>
              </div>
              <form onsubmit="handleAdminLogin(event)" class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Staff ID / Access PIN</label>
                  <input id="admin-pin" type="password" required class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:outline-none" placeholder="••••••" />
                </div>
                <button id="admin-submit" type="submit" class="w-full bg-emerald-800 text-white py-3 rounded-lg font-bold shadow-lg hover:bg-emerald-900 transition-colors flex items-center justify-center">
                  ${t("portalEntry")}
                </button>
              </form>
              <div class="mt-4 text-center">
                 <button onclick="setView('landing')" class="text-sm text-gray-500 hover:text-emerald-700">Cancel</button>
              </div>
            </div>
          </div>
        `;
      }

      function renderAdminDashboard() {
         return `
           <div class="min-h-screen bg-gray-50 flex items-center justify-center">
             <div class="text-center p-8">
               <h1 class="text-2xl font-bold text-gray-800 mb-4">Staff Dashboard</h1>
               <p class="text-gray-600 mb-6">Restricted access area. Please login as MD (Pin: 3333) for full features.</p>
               <button onclick="setView('landing')" class="bg-emerald-600 text-white px-6 py-2 rounded-lg">Return Home</button>
             </div>
           </div>
         `;
      }

      // --- Main Render Loop ---
      function render() {
        let content = "";
        if (state.view === "landing") content = renderLanding();
        else if (state.view === "miner-portal") content = renderMinerPortal(); // Defined in previous steps, ensuring reused
        else if (state.view === "digital-suite") content = renderDigitalSuite();
        else if (state.view === "artisan-form") content = renderArtisanForm();
        else if (state.view === "license-form") content = renderLicenseForm();
        else if (state.view === "status-check") content = `
          <div class="max-w-md w-full mx-auto px-4 py-8 animate-slide-in-right">
            <button onclick="setView('miner-portal')" class="text-gray-500 mb-4 flex items-center hover:text-gray-900 transition">${Icon("arrow-left", "w-5 h-5 mr-1")} ${t("back")}</button>
            <div class="bg-white rounded-2xl shadow-xl p-6 text-center">
              <h2 class="text-xl font-bold text-gray-800 mb-2">${t("checkStatusTitle")}</h2>
              <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-xl mb-4" placeholder="Enter ID..." />
              <button onclick="alert('No record found')" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">Check</button>
            </div>
          </div>`; // Simplified inline
        else if (state.view === "renew-check") content = `
          <div class="max-w-md w-full mx-auto px-4 py-8 animate-slide-in-right">
            <button onclick="setView('miner-portal')" class="text-gray-500 mb-4 flex items-center hover:text-gray-900 transition">${Icon("arrow-left", "w-5 h-5 mr-1")} ${t("back")}</button>
            <div class="bg-white rounded-2xl shadow-xl p-6 text-center">
              <h2 class="text-xl font-bold text-gray-800 mb-2">${t("renewTitle")}</h2>
              <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-xl mb-4" placeholder="License Number" />
              <button onclick="alert('System up to date')" class="w-full bg-orange-600 text-white py-3 rounded-xl font-bold">Proceed</button>
            </div>
          </div>`; // Simplified inline
        else if (state.view === "success") content = renderSuccess();
        else if (state.view === "admin-login") content = renderAdminLogin();
        else if (state.view === "admin-dashboard") content = renderAdminDashboard();
        else if (state.view === "md-dashboard") content = renderMDDashboard();

        const isMD = state.view === "md-dashboard";
        app.innerHTML = `
          ${isMD ? '' : renderHeader()}
          ${content}
          ${isMD ? '' : `
            <footer class="bg-emerald-900 text-white py-8 mt-auto text-center text-sm text-emerald-300">
               &copy; ${new Date().getFullYear()} Yobe State Mining Company. All rights reserved.
            </footer>
          `}
        `;
        lucide.createIcons();
      }

      function renderMinerPortal() {
          return `
          <div class="animate-fade-in-up min-h-[60vh]">
            <div class="relative bg-emerald-50 pb-8 rounded-b-[2.5rem] overflow-hidden">
              <div class="max-w-md mx-auto px-6 pt-6 text-center relative z-10">
                <h2 class="text-2xl font-bold text-emerald-900 mb-2">${t("welcome")}, Miner!</h2>
                <div class="grid grid-cols-2 gap-4 mt-6">
                  <button onclick="setView('artisan-form')" class="bg-white p-4 rounded-2xl shadow-md border-b-4 border-yellow-400 active:border-b-0 active:translate-y-1 transition-all flex flex-col items-center gap-2 group hover:bg-yellow-50">
                    <div class="w-12 h-12 bg-yellow-100 text-yellow-600 rounded-full flex items-center justify-center">${Icon("user","w-6 h-6")}</div>
                    <span class="font-bold text-sm text-gray-800 leading-tight">${t("registerArtisan")}</span>
                  </button>
                  <button onclick="setView('license-form')" class="bg-white p-4 rounded-2xl shadow-md border-b-4 border-emerald-500 active:border-b-0 active:translate-y-1 transition-all flex flex-col items-center gap-2 group hover:bg-emerald-50">
                    <div class="w-12 h-12 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center">${Icon("scroll-text","w-6 h-6")}</div>
                    <span class="font-bold text-sm text-gray-800 leading-tight">${t("applyLicense")}</span>
                  </button>
                  <button onclick="setView('status-check')" class="bg-white p-4 rounded-2xl shadow-md border-b-4 border-blue-400 active:border-b-0 active:translate-y-1 transition-all flex flex-col items-center gap-2 group hover:bg-blue-50">
                    <div class="w-12 h-12 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center">${Icon("credit-card","w-6 h-6")}</div>
                    <span class="font-bold text-sm text-gray-800 leading-tight">${t("idCard")}</span>
                  </button>
                  <button onclick="setView('renew-check')" class="bg-white p-4 rounded-2xl shadow-md border-b-4 border-orange-400 active:border-b-0 active:translate-y-1 transition-all flex flex-col items-center gap-2 group hover:bg-orange-50">
                    <div class="w-12 h-12 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center">${Icon("refresh-cw","w-6 h-6")}</div>
                    <span class="font-bold text-sm text-gray-800 leading-tight">${t("renew")}</span>
                  </button>
                </div>
                <button onclick="setView('digital-suite')" class="mt-5 w-full bg-gray-900 text-white p-4 rounded-2xl shadow-lg hover:bg-black transition flex items-center justify-center gap-2">
                  ${Icon("layout-dashboard","w-5 h-5")} ${t("digitalSuite")}
                </button>
              </div>
            </div>
          </div>
          `;
      }

      render();
    })();
  </script>
</body>
</html>
