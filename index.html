<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <title>Yobe State Mining Company</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Lucide Icons (UMD) -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

  <!-- html2canvas for downloading images -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Playfair+Display:ital,wght@0,600;0,800;1,600&display=swap');

    body { font-family: 'Inter', sans-serif; }
    .font-serif { font-family: 'Playfair Display', serif; }
    .pb-safe { padding-bottom: env(safe-area-inset-bottom); }

    /* Animations */
    @keyframes fade-in-up {
      from { opacity: 0; transform: translateY(20px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in-up { animation: fade-in-up .5s ease-out forwards; }

    @keyframes slide-in-right {
      from { opacity: 0; transform: translateX(20px); }
      to   { opacity: 1; transform: translateX(0); }
    }
    .animate-slide-in-right { animation: slide-in-right .4s ease-out forwards; }

    @keyframes bounce-short {
      0%, 100% { transform: translateY(0); }
      50%      { transform: translateY(-6px); }
    }
    .animate-bounce-short { animation: bounce-short 1s infinite; }
    
    @keyframes pulse-ring {
      0% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
      70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
      100% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
    }
    .marker-pulse { animation: pulse-ring 2s infinite; }
    
    /* Custom Scrollbar for dashboards */
    .custom-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
    .custom-scroll::-webkit-scrollbar-track { bg: transparent; }
    .custom-scroll::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 3px; }

    /* Simple CSS Charts */
    .pie-chart {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: conic-gradient(
        #10b981 0% 45%, 
        #f59e0b 45% 75%, 
        #3b82f6 75% 100%
      );
    }
    
    .soft-glow { box-shadow: 0 0 0 6px rgba(16, 185, 129, 0.08); }
  </style>
</head>

<body class="bg-gray-50 text-gray-800 antialiased selection:bg-green-200 selection:text-green-900">
  <div id="app" class="min-h-screen flex flex-col"></div>

  <script>
    (function() {
      // --- Assets ---
      const ASSETS = {
        coatOfArms: "https://upload.wikimedia.org/wikipedia/commons/thumb/b/bc/Coat_of_arms_of_Nigeria.svg/1200px-Coat_of_arms_of_Nigeria.svg.png",
        miningLogo: "https://cdn-icons-png.flaticon.com/512/2592/2592175.png",
        mapBg: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/ec/Yobe_State_in_Nigeria.svg/1200px-Yobe_State_in_Nigeria.svg.png",
        dashBg: "https://images.unsplash.com/photo-1576082989508-e16109968803?q=80&w=2070&auto=format&fit=crop"
      };

      // --- Translations ---
      const translations = {
        en: {
          appTitle: "Yobe State Mining Company",
          subtitle: "Regulating & Empowering Mining Activities",
          welcome: "Welcome",
          start: "Start Here",
          portalEntry: "Enter Portal",
          adminLogin: "Staff Login",
          home: "Home",
          services: "Services",
          contact: "Contact",
          digitalSuite: "Digital Mining Suite",

          // Forms
          applyLicense: "Apply for License",
          applyLicenseDesc: "For companies and large scale mining.",
          registerArtisan: "Register as Artisan",
          registerArtisanDesc: "For individual local miners.",
          idCard: "Get Miner ID Card",
          renew: "Renew Papers",
          
          formName: "Full Name",
          formCompany: "Company Name",
          formRC: "RC Number",
          formPhone: "Phone Number",
          formLocation: "Mining Location / LGA",
          formMineral: "Mineral Type",
          formPhoto: "Upload Photo",
          formCAC: "CAC Certificate",
          
          submit: "Submit Application",
          processing: "Processing...",
          success: "Successful!",
          download: "Download/Save",
          downloadID: "Download ID Card",
          downloadCert: "Download Certificate",
          back: "Back",
          
          // Validation
          companySuffixError: "Company name must end with LTD, Limited, PLC, Enterprise, LLC, Venture, or Company.",
          phoneError: "Phone number must be exactly 11 digits.",
          required: "This field is required.",
          
          // Dashboard
          dashboard: "Executive Dashboard",
          mdDashboard: "MD Command Center",
          logout: "Logout",
          pendingApps: "Pending Applications",
          totalRevenue: "Total Revenue",
          activeMiners: "Active Miners",
          licensesIssued: "Licenses Issued",
          approve: "Approve",
          reject: "Reject",
          viewDocs: "View Docs",
          recentActivity: "Recent Activity",

          // Certs
          certTitle: "CERTIFICATE OF MINING",
          certBody: "This is to certify that the company listed below has been duly registered and authorized to carry out mining activities within Yobe State in accordance with the state regulations.",
          signature: "Hon. Commissioner",
          validUntil: "Valid Until",
          issuedOn: "Issued On",

          // Status / Renew
          checkStatusTitle: "Check Application Status",
          enterId: "Enter your ID number to verify ID card / license.",
          notFound: "No record found for this ID (demo).",
          renewTitle: "Renewal Portal",

          // Digital Suite
          dsTitle: "Digital Mining Suite",
          dsSub: "Exploration, extraction, logistics, data intelligence, and compliance — unified.",
          dsP1: "Deploy modern mining software for exploration, extraction, and logistics management.",
          dsP2: "Establish digital data management systems to ensure efficiency in decision-making.",
          dsP3: "Introduce automated compliance monitoring tools for regulatory adherence.",
          dsExplore: "Exploration & GIS",
          dsExtract: "Extraction & Fleet",
          dsLogistics: "Logistics & Supply Chain",
          dsData: "Data Management",
          dsCompliance: "Compliance Monitor",
          dsOpen: "Open Suite",
          dsViewCompliance: "View Compliance Monitor",
          dsViewOps: "View Operations",

          // Compliance monitor
          complianceScore: "Compliance Score",
          openCases: "Open Cases",
          autoFlags: "Auto Flags",
          resolve: "Mark Resolved",
          severityHigh: "High",
          severityMed: "Medium",
          severityLow: "Low",
          
          // Data management
          dataPipeline: "Data Pipeline",
          lastSync: "Last Sync",
          recordsToday: "Records Today",
          ingestOK: "Ingest OK",
          ingestWarn: "Ingest Warning",
          ingestDown: "Ingest Down",
          
          footerDesc: "Official platform for regulating mining activities within Yobe State, ensuring safety, compliance, and economic growth.",
          quickLinks: "Quick Links",
          contactUs: "Contact Us"
        },
        ha: {
          appTitle: "Kamfanin Hakar Ma'adinai na Jihar Yobe",
          subtitle: "Rungumar Ayyukan Hakar Ma'adinai",
          welcome: "Barka da zuwa",
          start: "Fara Anan",
          portalEntry: "Shiga Shafin",
          adminLogin: "Shiga na Ma'aikata",
          home: "Gida",
          services: "Ayyuka",
          contact: "Tuntube Mu",
          digitalSuite: "Tsarin Dijital na Ma'adinai",

          applyLicense: "Nemi Lasisi",
          applyLicenseDesc: "Domin manyan kamfanoni.",
          registerArtisan: "Yi Rajistar 'Yan Haka",
          registerArtisanDesc: "Domin kananan masu hakar ma'adinai.",
          idCard: "Karbi Katin Shaida",
          renew: "Sabunta Takardu",

          formName: "Cikakken Suna",
          formCompany: "Sunan Kamfani",
          formRC: "Lambar RC",
          formPhone: "Lambar Waya",
          formLocation: "Wurin Haka / Karamar Hukuma",
          formMineral: "Nau'in Ma'adani",
          formPhoto: "Saka Hoto",
          formCAC: "Takardar CAC",

          submit: "Aika Bukata",
          processing: "Ana Aiki...",
          success: "An Yi Nasara!",
          download: "Sauke/Ajiye",
          downloadID: "Sauke Katin ID",
          downloadCert: "Sauke Takardar Lasisi",
          back: "Baya",

          companySuffixError: "Sunan kamfani dole ya kare da LTD, Limited, PLC, da sauransu.",
          phoneError: "Lambar waya dole ta kasance lamba 11.",
          required: "Ana bukatar wannan.",

          dashboard: "Dashboard na Shugabanni",
          mdDashboard: "Cibiyar MD",
          logout: "Fita",
          pendingApps: "Bukatu masu Jira",
          totalRevenue: "Jimlar Kudin Shiga",
          activeMiners: "Masu Haka Masu Aiki",
          licensesIssued: "Lasisi da aka Bayar",
          approve: "Amince",
          reject: "Kiyi",
          viewDocs: "Duba Takardu",
          recentActivity: "Ayyukan Kwanan Nan",

          certTitle: "TAKARDAR LASISI",
          certBody: "Wannan takardar shaida ce cewa kamfanin da ke kasa ya yi rajista kuma an ba shi izinin gudanar da ayyukan hakar ma'adinai a Jihar Yobe.",
          signature: "Kwamishina",
          validUntil: "Yana aiki har",
          issuedOn: "An bayar ranar",

          checkStatusTitle: "Duba Matsayi",
          enterId: "Saka lambar ID domin tabbatarwa.",
          notFound: "Ba a sami wannan ID ba (demo).",
          renewTitle: "Shafin Sabuntawa",

          dsTitle: "Tsarin Dijital na Ma'adinai",
          dsSub: "Bincike, hakowa, jigila, bayanai, da bin doka — a wuri guda.",
          dsP1: "Kafa manhajar zamani don bincike, hakowa, da kula da jigila.",
          dsP2: "Kafa tsarin sarrafa bayanai domin yanke shawara cikin sauri.",
          dsP3: "Kafa na'urar sa ido ta bin doka kai-tsaye.",
          dsExplore: "Bincike & Taswira",
          dsExtract: "Hakowa & Na'urori",
          dsLogistics: "Jigila & Sarkar Kaya",
          dsData: "Sarrafa Bayanai",
          dsCompliance: "Sa Ido na Doka",
          dsOpen: "Bude Tsari",
          dsViewCompliance: "Duba Sa Ido",
          dsViewOps: "Duba Ayyuka",
          
          complianceScore: "Matsayin Bin Doka",
          openCases: "Batutuwan Buɗe",
          autoFlags: "Gargaɗin Kai-tsaye",
          resolve: "Alama An Kammala",
          severityHigh: "Mai Tsanani",
          severityMed: "Matsakaici",
          severityLow: "Ƙasa",

          dataPipeline: "Hanyar Bayanai",
          lastSync: "Na Ƙarshe",
          recordsToday: "Bayanai Yau",
          ingestOK: "Komai Lafiya",
          ingestWarn: "Gargaɗi",
          ingestDown: "Ya Tsaya",

          footerDesc: "Shafin hukuma na kula da ayyukan hakar ma'adinai a Jihar Yobe, tabbatar da tsaro, bin doka, da ci gaban tattalin arziki.",
          quickLinks: "Hanyoyi Masu Sauki",
          contactUs: "Tuntube Mu"
        }
      };

      const LGAs = ["Damaturu","Potiskum","Nguru","Gashua","Geidam","Buni Yadi","Fika","Nangere", "Jakusko", "Bade", "Bursari", "Fune", "Gulani", "Gujba", "Karasuwa", "Machina", "Tarmuwa", "Yusufari"];

      // --- Helpers ---
      const iso = (d) => new Date(d).toISOString().split('T')[0];
      const now = () => new Date();
      const addDays = (days) => { const d = new Date(); d.setDate(d.getDate() + days); return d; };
      const addYears = (years) => { const d = new Date(); d.setFullYear(d.getFullYear() + years); return d; };
      const formatDate = (date) => new Date(date).toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });

      // Seed some realistic issue/expiry dates for compliance demo
      const initialApplications = [
        { id: 101, name: "Ibrahim Musa", type: "Artisan", location: "Damaturu", mineral: "Gold", date: "2023-10-24", status: "Pending", photoURL: null, issueDate: null, expiryDate: null, rcNumber: null, flags: [] },
        { id: 102, name: "Yobe Gold Corp LTD", type: "License", location: "Fika", mineral: "Gypsum", rcNumber: "RC44211", date: "2023-10-25", status: "Pending", photoURL: null, issueDate: null, expiryDate: null, flags: [] },
        { id: 103, name: "Fatima Sani", type: "Artisan", location: "Nguru", mineral: "Kaolin", date: "2023-10-23", status: "Approved", photoURL: null, issueDate: iso(addDays(-90)), expiryDate: iso(addDays(275)), rcNumber: null, flags: [] },
        { id: 104, name: "Desert Sands Ltd", type: "License", location: "Geidam", mineral: "Limestone", rcNumber: "RC99882", date: "2023-10-22", status: "Approved", photoURL: null, issueDate: iso(addDays(-420)), expiryDate: iso(addDays(-20)), flags: [] }, // expired
        { id: 105, name: "Aliyu Bello", type: "Artisan", location: "Potiskum", mineral: "Gold", date: "2023-10-26", status: "Pending", photoURL: null, issueDate: null, expiryDate: null, rcNumber: null, flags: [] },
      ];

      // --- State Management ---
      window.state = {
        lang: "en",
        view: "landing", 
        currentUserRole: null, // 'staff' | 'md' | null
        isLoading: false,
        error: null,
        adminSearch: "",
        applications: [...initialApplications], // Mutable state
        previewAppId: null, // For viewing certificate/ID in modal
        timeString: new Date().toLocaleTimeString(),

        // Digital Suite tabs
        dsTab: "explore", // explore | extract | logistics | data | compliance

        // Compliance Cases
        complianceCases: [
          { id: "C-001", severity: "High", title: "Expired license detected", detail: "Desert Sands Ltd (RC99882) has an expired license. Auto-flagged for enforcement.", createdAt: iso(addDays(-2)), resolved: false },
          { id: "C-002", severity: "Medium", title: "Unregistered machinery", detail: "Heavy equipment in Zone 4 not linked to any approved operator.", createdAt: iso(addDays(-1)), resolved: false },
          { id: "C-003", severity: "Low", title: "Missing ID photo", detail: "Artisan record missing photo attachment.", createdAt: iso(addDays(-6)), resolved: true },
        ],

        // Data pipeline health
        dataOps: {
          status: "OK",            // OK | WARN | DOWN
          lastSync: new Date(Date.now() - 1000*60*18),  // 18 mins ago
          recordsToday: 18421,
          ingestRatePerMin: 420,
          anomaliesToday: 6
        },

        // Operations (exploration/extraction/logistics)
        ops: {
          exploration: { activeMissions: 12, gisLayers: 19, drillTargets: 7, samplesToday: 148 },
          extraction:  { activeSites: 6, equipmentOnline: 83, equipmentOffline: 9, tonnageToday: 1240 },
          logistics:   { shipmentsInTransit: 31, deliveredToday: 18, fleetOnline: 42, fleetIdle: 7 }
        },
        
        // Form Data
        formData: {
          name: "", 
          companyName: "",
          rcNumber: "",
          phone: "",
          lga: LGAs[0],
          mineral: "Gypsum",
          photoURL: null, 
          cacName: ""     
        },
        
        // Result Data (for newly created applications)
        generatedId: "",
        expiryDate: "",
        issueDate: ""
      };

      // Interval for live clock in MD dashboard
      setInterval(() => {
        state.timeString = new Date().toLocaleTimeString();
        const timeEls = document.querySelectorAll('.live-time');
        timeEls.forEach(el => el.innerText = state.timeString);
      }, 1000);

      const state = window.state;
      const t = (key) => translations[state.lang][key] || key;
      const app = document.getElementById("app");

      // --- View Utils ---
      const setView = (view) => {
        state.view = view;
        state.error = null;
        window.scrollTo({ top: 0, behavior: 'instant' });
        render();
      };
      window.setView = setView; 

      window.toggleLang = function() {
        state.lang = state.lang === "en" ? "ha" : "en";
        render();
      };

      window.scrollToBottom = function() {
        window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
      }

      // --- Digital Suite controls ---
      window.setDsTab = function (tab) {
        state.dsTab = tab;
        render();
      };

      window.resolveCase = function (caseId) {
        const c = state.complianceCases.find(x => x.id === caseId);
        if (c) c.resolved = true;
        render();
      };

      // --- Form Handlers ---
      window.handlePhotoUpload = function(event) {
        const file = event.target.files[0];
        if (file) {
          state.formData.photoURL = URL.createObjectURL(file);
          render(); 
        }
      };

      window.handleCACUpload = function(event) {
        const file = event.target.files[0];
        if (file) {
          state.formData.cacName = file.name;
          render();
        }
      };

      window.handleAdminSearch = function(event) {
        state.adminSearch = event.target.value;
        render();
      }

      window.handleSort = function(criteria) {
        if (criteria === 'date') {
            state.applications.sort((a,b) => new Date(b.date) - new Date(a.date));
        } else if (criteria === 'status') {
            state.applications.sort((a,b) => a.status.localeCompare(b.status));
        }
        render();
      }

      // --- Application Logic ---
      window.viewApplication = function(id) {
        state.previewAppId = id;
        render(); // This will trigger the modal
      }

      window.closePreview = function() {
        state.previewAppId = null;
        render();
      }

      window.updateStatus = function(id, newStatus) {
        const app = state.applications.find(a => a.id === id);
        if (app) {
          app.status = newStatus;
          // If approved, stamp issue/expiry for compliance + doc display
          if (newStatus === "Approved") {
            app.issueDate = app.issueDate || iso(now());
            app.expiryDate = app.expiryDate || iso(addYears(1));
          }
          render();
        }
      }

      // --- Validation ---
      function validateForm(type) {
        const { name, companyName, rcNumber, phone, photoURL, cacName } = state.formData;
        const errors = [];

        if (!/^\d{11}$/.test(phone)) {
          errors.push(t("phoneError"));
        }

        if (type === 'artisan') {
          if (!name.trim()) errors.push(t("required"));
          if (!photoURL) errors.push(t("required"));
        } 
        else if (type === 'license') {
          const validSuffixes = ['ltd', 'limited', 'plc', 'enterprise', 'llc', 'venture', 'company', 'ltd.', 'inc'];
          const lowerName = companyName.toLowerCase().trim();
          const hasValidSuffix = validSuffixes.some(suffix => lowerName.endsWith(suffix));
          
          if (!companyName.trim() || !hasValidSuffix) {
            errors.push(t("companySuffixError"));
          }
          if (!rcNumber.trim()) errors.push(t("required"));
          if (!cacName) errors.push(t("required"));
        }

        return errors;
      }

      window.submitForm = function(type) {
        const errors = validateForm(type);
        if (errors.length > 0) {
          state.error = errors.join(" ");
          render();
          return;
        }

        state.isLoading = true;
        render();

        setTimeout(() => {
          state.isLoading = false;
          state.generatedId = type === 'artisan' 
            ? `ART-${Math.floor(100000 + Math.random() * 900000)}` 
            : `YSM-${state.formData.rcNumber}`;
          state.issueDate = new Date();
          state.expiryDate = addYears(1);
          
          // Add to applications list for demo purposes
          const newApp = {
             id: Math.floor(Math.random() * 10000),
             name: type === 'artisan' ? state.formData.name : state.formData.companyName,
             type: type === 'artisan' ? 'Artisan' : 'License',
             location: state.formData.lga,
             mineral: state.formData.mineral,
             date: iso(now()),
             status: "Pending",
             photoURL: state.formData.photoURL,
             rcNumber: type === 'license' ? state.formData.rcNumber : null,
             issueDate: null,
             expiryDate: null,
             flags: []
          };
          state.applications.unshift(newApp);

          setView("success");
        }, 1500);
      };

      window.handleAdminLogin = function(e) {
        e.preventDefault();
        const input = document.getElementById("admin-pin");
        const btn = document.getElementById("admin-submit");
        
        if (!input.value) return;

        if(btn) btn.innerHTML = t("processing");
        
        setTimeout(() => {
          if (input.value === "3333") {
             state.currentUserRole = 'md';
             setView('md-dashboard');
          } else {
             state.currentUserRole = 'staff';
             setView('admin-dashboard');
          }
        }, 1000);
      }
      
      window.logout = function() {
        state.currentUserRole = null;
        setView('landing');
      }

      // --- Download Function ---
      window.downloadElement = async function(elementId, fileName) {
        const element = document.getElementById(elementId);
        if (!element) return;
        
        try {
          const canvas = await html2canvas(element, { 
            scale: 2, 
            useCORS: true, 
            backgroundColor: null 
          });
          const link = document.createElement('a');
          link.download = `${fileName}.png`;
          link.href = canvas.toDataURL();
          link.click();
        } catch (err) {
          console.error("Download failed", err);
          alert("Could not generate image. Please try again.");
        }
      };

      // --- Compliance Logic ---
      function severityColor(sev) {
        if (sev === "High") return { pill: "bg-red-100 text-red-800", dot: "bg-red-500", text: "text-red-600" };
        if (sev === "Medium") return { pill: "bg-yellow-100 text-yellow-800", dot: "bg-yellow-500", text: "text-yellow-700" };
        return { pill: "bg-blue-100 text-blue-800", dot: "bg-blue-500", text: "text-blue-700" };
      }

      function computeAutoFlags() {
        const today = iso(now());
        const flags = [];

        // App-based rules
        state.applications.forEach(a => {
          if (a.status === "Approved") {
            if (a.expiryDate && a.expiryDate < today) {
              flags.push({ severity: "High", title: "Expired license", detail: `${a.name} (${a.type}) expired on ${a.expiryDate}.`, ref: a.id });
            }
            if (a.type === "Artisan" && !a.photoURL) {
              flags.push({ severity: "Low", title: "Missing photo", detail: `${a.name} (Artisan) has no photo on file.`, ref: a.id });
            }
            if (a.type === "License" && !a.rcNumber) {
              flags.push({ severity: "Medium", title: "Missing RC number", detail: `${a.name} license record missing RC number.`, ref: a.id });
            }
          }
        });

        // “Sensor” / operational signals (demo)
        flags.push({ severity: "Medium", title: "Geo-fence anomaly", detail: "Unmapped excavation activity detected near Zone 4 boundary.", ref: "OPS" });
        flags.push({ severity: "Low", title: "Data drift", detail: "Mineral grade distribution shifted vs. last 30 days baseline.", ref: "DATA" });

        // Deduplicate quick by title+detail
        const uniq = [];
        const seen = new Set();
        for (const f of flags) {
          const k = f.title + "|" + f.detail;
          if (!seen.has(k)) { seen.add(k); uniq.push(f); }
        }
        return uniq;
      }

      function complianceScore() {
        const approved = state.applications.filter(a => a.status === "Approved").length;
        const total = state.applications.length;
        const base = total ? Math.round((approved / total) * 100) : 0;

        const autoFlags = computeAutoFlags().filter(f => f.severity === "High").length;
        const penalty = Math.min(25, autoFlags * 6);

        return Math.max(0, base - penalty);
      }

      // --- Components ---
      function Icon(name, className="w-5 h-5") {
        return `<i data-lucide="${name}" class="${className}"></i>`;
      }

      function statusPill(status) {
         const cls = status === "Approved" ? "bg-green-100 text-green-800" : status === "Rejected" ? "bg-red-100 text-red-800" : "bg-yellow-100 text-yellow-800";
         const dot = status === "Approved" ? "bg-green-500" : status === "Rejected" ? "bg-red-500" : "bg-yellow-500";
         return `<span class="flex items-center w-fit px-2.5 py-0.5 rounded-full text-xs font-medium ${cls}"><span class="w-1.5 h-1.5 rounded-full mr-1.5 ${dot}"></span>${status}</span>`;
      }

      function renderHeader() {
        return `
          <header class="bg-gradient-to-r from-emerald-900 to-emerald-700 text-white p-4 shadow-lg sticky top-0 z-50">
            <div class="flex justify-between items-center max-w-6xl mx-auto">
              <div class="flex items-center space-x-3 cursor-pointer group" onclick="setView('landing')">
                <div class="w-10 h-10 bg-yellow-400 rounded-full flex items-center justify-center shadow-md border-2 border-white group-hover:scale-105 transition-transform">
                  ${Icon("pickaxe","text-emerald-900 w-6 h-6")}
                </div>
                <div>
                  <h1 class="font-bold text-sm md:text-lg leading-tight tracking-wide">${t("appTitle")}</h1>
                  <p class="text-[10px] md:text-xs text-emerald-200 uppercase tracking-wider hidden md:block">${t("subtitle")}</p>
                </div>
              </div>

              <div class="flex items-center space-x-4">
                <nav class="hidden md:flex space-x-6 text-sm font-medium text-emerald-100">
                  <button onclick="setView('landing')" class="hover:text-white hover:underline">${t("home")}</button>
                  <button onclick="setView('miner-portal')" class="hover:text-white hover:underline">${t("services")}</button>
                  <button onclick="setView('digital-suite')" class="hover:text-white hover:underline">${t("digitalSuite")}</button>
                  <button onclick="scrollToBottom()" class="hover:text-white hover:underline">${t("contact")}</button>
                </nav>

                <button onclick="toggleLang()" class="flex items-center bg-white/10 hover:bg-white/20 px-3 py-1.5 rounded-full transition-all text-xs md:text-sm font-medium border border-white/20 backdrop-blur-sm">
                  ${Icon("languages","w-4 h-4 mr-2")}
                  ${state.lang === "en" ? "HA" : "EN"}
                </button>
              </div>
            </div>
          </header>
        `;
      }

      function renderFooter() {
        return `
          <footer class="bg-emerald-900 text-white pt-12 pb-6 mt-auto">
            <div class="max-w-6xl mx-auto px-6 grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
              <div>
                <div class="flex items-center space-x-2 mb-4">
                  ${Icon("pickaxe","text-yellow-400 w-6 h-6")}
                  <span class="font-bold text-lg">${t("appTitle")}</span>
                </div>
                <p class="text-emerald-200 text-sm leading-relaxed mb-4">${t("footerDesc")}</p>
              </div>

              <div>
                <h3 class="font-bold text-yellow-400 mb-4 uppercase tracking-wider text-sm">${t("quickLinks")}</h3>
                <ul class="space-y-2 text-emerald-200 text-sm">
                  <li><button onclick="setView('license-form')" class="hover:text-white transition-colors">Apply for License</button></li>
                  <li><button onclick="setView('status-check')" class="hover:text-white transition-colors">Check Status</button></li>
                  <li><button onclick="setView('renew-check')" class="hover:text-white transition-colors">Renewals</button></li>
                  <li><button onclick="setView('digital-suite')" class="hover:text-white transition-colors">${t("digitalSuite")}</button></li>
                </ul>
              </div>

              <div>
                <h3 class="font-bold text-yellow-400 mb-4 uppercase tracking-wider text-sm">${t("contactUs")}</h3>
                <ul class="space-y-3 text-emerald-200 text-sm">
                  <li class="flex items-start space-x-3">
                    ${Icon("map-pin","w-5 h-5 text-yellow-400 shrink-0 mt-0.5")}
                    <span>No. 12 Bukar Abba Ibrahim Way, Damaturu, Yobe State.</span>
                  </li>
                  <li class="flex items-center space-x-3">
                    ${Icon("phone","w-5 h-5 text-yellow-400 shrink-0")}
                    <span>+234 800 MINING YB</span>
                  </li>
                </ul>
              </div>
            </div>

            <div class="border-t border-emerald-800 pt-6 text-center text-xs text-emerald-400">
              &copy; ${new Date().getFullYear()} Yobe State Mining Company. All rights reserved.
            </div>
          </footer>
        `;
      }

      function renderLanding() {
        const score = complianceScore();
        const autoFlags = computeAutoFlags();
        const openCases = state.complianceCases.filter(c => !c.resolved).length;

        return `
          <div class="animate-fade-in-up">
            <div class="relative bg-emerald-900 text-white overflow-hidden">
              <div class="absolute inset-0 bg-[url('${ASSETS.dashBg}')] bg-cover bg-center opacity-20"></div>
              <div class="absolute inset-0 bg-gradient-to-r from-emerald-900/90 to-emerald-800/80"></div>

              <div class="relative max-w-6xl mx-auto px-6 py-24 md:py-32 flex flex-col md:flex-row items-center">
                <div class="md:w-1/2 mb-10 md:mb-0">
                  <div class="inline-block px-3 py-1 bg-yellow-400 text-emerald-900 text-xs font-bold rounded-full mb-4 uppercase tracking-wider">
                    Official Portal
                  </div>
                  <h1 class="text-4xl md:text-6xl font-bold mb-6 leading-tight">
                    ${t("subtitle")}
                  </h1>
                  <p class="text-emerald-100 text-lg mb-8 max-w-lg">
                    Streamlining mining operations in Yobe State through digital innovation. Register, apply, and monitor efficiently.
                  </p>

                  <div class="flex flex-col sm:flex-row gap-4">
                    <button onclick="setView('miner-portal')" class="bg-yellow-400 text-emerald-900 px-8 py-4 rounded-xl font-bold hover:bg-yellow-300 transition-all transform hover:scale-105 shadow-lg flex items-center justify-center">
                      ${t("portalEntry")} ${Icon("arrow-right","ml-2 w-5 h-5")}
                    </button>
                    <button onclick="setView('digital-suite')" class="bg-white/10 border border-white/20 text-white px-8 py-4 rounded-xl font-bold hover:bg-white/20 transition-all flex items-center justify-center">
                      ${Icon("layout-dashboard","mr-2 w-5 h-5")} ${t("digitalSuite")}
                    </button>
                    <button onclick="setView('admin-login')" class="bg-transparent border-2 border-white/30 text-white px-8 py-4 rounded-xl font-bold hover:bg-white/10 transition-all flex items-center justify-center">
                      ${Icon("lock","mr-2 w-4 h-4")} ${t("adminLogin")}
                    </button>
                  </div>

                  <div class="mt-8 grid grid-cols-1 sm:grid-cols-3 gap-3">
                    <div class="bg-white/10 border border-white/10 rounded-xl p-4 backdrop-blur-sm">
                      <div class="text-[11px] uppercase tracking-wider text-emerald-200 mb-1">${t("complianceScore")}</div>
                      <div class="text-2xl font-bold">${score}%</div>
                      <div class="text-[11px] text-emerald-200 mt-1 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-emerald-300 soft-glow"></span> Auto monitoring enabled
                      </div>
                    </div>
                    <div class="bg-white/10 border border-white/10 rounded-xl p-4 backdrop-blur-sm">
                      <div class="text-[11px] uppercase tracking-wider text-emerald-200 mb-1">${t("openCases")}</div>
                      <div class="text-2xl font-bold">${openCases}</div>
                      <div class="text-[11px] text-emerald-200 mt-1">Investigation queue</div>
                    </div>
                    <div class="bg-white/10 border border-white/10 rounded-xl p-4 backdrop-blur-sm">
                      <div class="text-[11px] uppercase tracking-wider text-emerald-200 mb-1">${t("autoFlags")}</div>
                      <div class="text-2xl font-bold">${autoFlags.length}</div>
                      <div class="text-[11px] text-emerald-200 mt-1">Rules engine alerts</div>
                    </div>
                  </div>
                </div>

                <div class="md:w-1/2 flex justify-center">
                  <!-- Stats or Features -->
                  <div class="bg-emerald-800/80 backdrop-blur-sm p-6 rounded-2xl border border-emerald-600/50 shadow-2xl max-w-sm">
                     <div class="flex items-center gap-4 mb-4 border-b border-white/10 pb-4">
                        <div class="bg-white/10 p-3 rounded-full">${Icon("shield-check", "text-yellow-400 w-6 h-6")}</div>
                        <div>
                           <div class="font-bold text-lg">Fully Digital</div>
                           <div class="text-xs text-emerald-200">Secure & Fast Processing</div>
                        </div>
                     </div>
                     <div class="flex items-center gap-4 mb-4 border-b border-white/10 pb-4">
                        <div class="bg-white/10 p-3 rounded-full">${Icon("database", "text-yellow-400 w-6 h-6")}</div>
                        <div>
                           <div class="font-bold text-lg">Data Intelligence</div>
                           <div class="text-xs text-emerald-200">Operational decisions in real-time</div>
                        </div>
                     </div>
                     <div class="flex items-center gap-4">
                        <div class="bg-white/10 p-3 rounded-full">${Icon("scan-line", "text-yellow-400 w-6 h-6")}</div>
                        <div>
                           <div class="font-bold text-lg">Compliance Monitor</div>
                           <div class="text-xs text-emerald-200">Automated flags + audit trail</div>
                        </div>
                     </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="bg-white py-12 border-b border-gray-100">
              <div class="max-w-6xl mx-auto px-6 grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
                <div>
                  <div class="text-3xl md:text-4xl font-bold text-emerald-800 mb-1">2,500+</div>
                  <div class="text-gray-500 text-sm uppercase tracking-wide">Registered Miners</div>
                </div>
                <div>
                  <div class="text-3xl md:text-4xl font-bold text-emerald-800 mb-1">150+</div>
                  <div class="text-gray-500 text-sm uppercase tracking-wide">Companies</div>
                </div>
                <div>
                  <div class="text-3xl md:text-4xl font-bold text-emerald-800 mb-1">17</div>
                  <div class="text-gray-500 text-sm uppercase tracking-wide">LGAs Covered</div>
                </div>
                <div>
                  <div class="text-3xl md:text-4xl font-bold text-emerald-800 mb-1">98%</div>
                  <div class="text-gray-500 text-sm uppercase tracking-wide">Compliance Rate</div>
                </div>
              </div>
            </div>
          </div>
        `;
      }

      function renderMinerPortal() {
        return `
          <div class="animate-fade-in-up min-h-[60vh]">
            <div class="relative bg-emerald-50 pb-8 rounded-b-[2.5rem] overflow-hidden">
              <div class="absolute top-0 left-0 w-full h-32 bg-emerald-600 rounded-b-[50%] scale-x-150 -translate-y-16 opacity-20"></div>

              <div class="max-w-md mx-auto px-6 pt-6 text-center relative z-10">
                <h2 class="text-2xl font-bold text-emerald-900 mb-2">${t("welcome")}, Miner!</h2>
                <p class="text-gray-600 mb-6">Select an option below to begin.</p>

                <div class="grid grid-cols-2 gap-4">
                  <button onclick="setView('artisan-form')" class="bg-white p-4 rounded-2xl shadow-md border-b-4 border-yellow-400 active:border-b-0 active:translate-y-1 transition-all flex flex-col items-center gap-2 group hover:bg-yellow-50">
                    <div class="w-12 h-12 bg-yellow-100 text-yellow-600 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform">
                      ${Icon("user","w-6 h-6")}
                    </div>
                    <span class="font-bold text-sm text-gray-800 leading-tight">${t("registerArtisan")}</span>
                  </button>

                  <button onclick="setView('license-form')" class="bg-white p-4 rounded-2xl shadow-md border-b-4 border-emerald-500 active:border-b-0 active:translate-y-1 transition-all flex flex-col items-center gap-2 group hover:bg-emerald-50">
                    <div class="w-12 h-12 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform">
                      ${Icon("scroll-text","w-6 h-6")}
                    </div>
                    <span class="font-bold text-sm text-gray-800 leading-tight">${t("applyLicense")}</span>
                  </button>

                  <button onclick="setView('status-check')" class="bg-white p-4 rounded-2xl shadow-md border-b-4 border-blue-400 active:border-b-0 active:translate-y-1 transition-all flex flex-col items-center gap-2 group hover:bg-blue-50">
                    <div class="w-12 h-12 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform">
                      ${Icon("credit-card","w-6 h-6")}
                    </div>
                    <span class="font-bold text-sm text-gray-800 leading-tight">${t("idCard")}</span>
                  </button>

                  <button onclick="setView('renew-check')" class="bg-white p-4 rounded-2xl shadow-md border-b-4 border-orange-400 active:border-b-0 active:translate-y-1 transition-all flex flex-col items-center gap-2 group hover:bg-orange-50">
                    <div class="w-12 h-12 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform">
                      ${Icon("refresh-cw","w-6 h-6")}
                    </div>
                    <span class="font-bold text-sm text-gray-800 leading-tight">${t("renew")}</span>
                  </button>
                </div>

                <button onclick="setView('digital-suite')" class="mt-5 w-full bg-gray-900 text-white p-4 rounded-2xl shadow-lg hover:bg-black transition flex items-center justify-center gap-2">
                  ${Icon("layout-dashboard","w-5 h-5")} ${t("digitalSuite")}
                </button>
              </div>
            </div>
            
            <div class="max-w-md mx-auto px-6 mt-8">
               <button onclick="setView('landing')" class="w-full text-center text-gray-500 text-sm hover:text-emerald-700 font-medium">
                  &larr; ${t("back")} ${t("home")}
               </button>
            </div>
          </div>
        `;
      }

      function renderInput(label, id, type="text", placeholder="", value="", oninput="") {
        return `
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">${label}</label>
            <input type="${type}" id="${id}" 
              class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:outline-none transition-all"
              placeholder="${placeholder}"
              value="${value}"
              oninput="${oninput}"
            >
          </div>
        `;
      }

      function renderSelect(label, id, options, selectedValue, onchange) {
        return `
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">${label}</label>
            <div class="relative">
              <select id="${id}" onchange="${onchange}"
                class="w-full pl-4 pr-10 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:outline-none appearance-none"
              >
                ${options.map(opt => `<option value="${opt}" ${opt === selectedValue ? 'selected' : ''}>${opt}</option>`).join('')}
              </select>
              <div class="absolute right-3 top-3.5 pointer-events-none text-gray-400">
                ${Icon("chevron-down", "w-5 h-5")}
              </div>
            </div>
          </div>
        `;
      }

      function renderArtisanForm() {
        return `
          <div class="max-w-xl w-full mx-auto px-4 py-8 animate-slide-in-right">
            <button onclick="setView('miner-portal')" class="text-gray-500 mb-4 flex items-center hover:text-gray-900 transition">${Icon("arrow-left", "w-5 h-5 mr-1")} ${t("back")}</button>
            
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
              <div class="bg-yellow-500 p-4 text-emerald-900">
                <h2 class="text-xl font-bold flex items-center gap-2">
                  ${Icon("pickaxe")} ${t("registerArtisan")}
                </h2>
              </div>
              
              <div class="p-6">
                ${state.error ? `<div class="bg-red-50 text-red-600 p-3 rounded-lg text-sm mb-4 border border-red-100">${state.error}</div>` : ''}

                ${renderInput(t("formName"), "inp-name", "text", "Musa Ibrahim", state.formData.name, "state.formData.name = this.value")}
                ${renderInput(t("formPhone"), "inp-phone", "tel", "08012345678", state.formData.phone, "state.formData.phone = this.value.replace(/\\D/g, '').slice(0, 11)")}
                
                ${renderSelect(t("formLocation"), "sel-lga", LGAs, state.formData.lga, "state.formData.lga = this.value")}
                ${renderSelect(t("formMineral"), "sel-mineral", ["Gypsum", "Limestone", "Gold", "Diatomite", "Kaolin", "Potash"], state.formData.mineral, "state.formData.mineral = this.value")}

                <div class="mb-6">
                  <label class="block text-sm font-medium text-gray-700 mb-1">${t("formPhoto")}</label>
                  <div class="flex items-center gap-4">
                    <label class="cursor-pointer bg-gray-100 hover:bg-gray-200 text-gray-600 px-4 py-3 rounded-xl border border-dashed border-gray-400 flex items-center gap-2 transition w-full justify-center">
                      ${Icon("camera", "w-5 h-5")} Upload Photo
                      <input type="file" accept="image/*" class="hidden" onchange="handlePhotoUpload(event)">
                    </label>
                    ${state.formData.photoURL ? `<img src="${state.formData.photoURL}" class="w-12 h-12 rounded-full object-cover border-2 border-yellow-500 shadow-sm">` : ''}
                  </div>
                </div>

                <button onclick="submitForm('artisan')" class="w-full bg-emerald-800 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-emerald-900 transition flex justify-center items-center">
                  ${state.isLoading ? Icon("loader-2", "animate-spin mr-2") : ""}
                  ${state.isLoading ? t("processing") : t("submit")}
                </button>
              </div>
            </div>
          </div>
        `;
      }

      function renderLicenseForm() {
        return `
          <div class="max-w-xl w-full mx-auto px-4 py-8 animate-slide-in-right">
            <button onclick="setView('miner-portal')" class="text-gray-500 mb-4 flex items-center hover:text-gray-900 transition">${Icon("arrow-left", "w-5 h-5 mr-1")} ${t("back")}</button>
            
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
              <div class="bg-emerald-700 p-4 text-white">
                <h2 class="text-xl font-bold flex items-center gap-2">
                  ${Icon("building-2")} ${t("applyLicense")}
                </h2>
              </div>
              
              <div class="p-6">
                ${state.error ? `<div class="bg-red-50 text-red-600 p-3 rounded-lg text-sm mb-4 border border-red-100">${state.error}</div>` : ''}

                ${renderInput(t("formCompany"), "inp-comp", "text", "e.g. Desert Mining Ltd", state.formData.companyName, "state.formData.companyName = this.value")}
                ${renderInput(t("formRC"), "inp-rc", "text", "RC123456", state.formData.rcNumber, "state.formData.rcNumber = this.value")}
                ${renderInput(t("formPhone"), "inp-phone", "tel", "08012345678", state.formData.phone, "state.formData.phone = this.value.replace(/\\D/g, '').slice(0, 11)")}
                
                ${renderSelect(t("formLocation"), "sel-lga", LGAs, state.formData.lga, "state.formData.lga = this.value")}
                ${renderSelect(t("formMineral"), "sel-mineral", ["Gypsum", "Limestone", "Gold", "Diatomite", "Kaolin", "Potash"], state.formData.mineral, "state.formData.mineral = this.value")}

                <div class="mb-6">
                  <label class="block text-sm font-medium text-gray-700 mb-1">${t("formCAC")}</label>
                  <label class="cursor-pointer bg-emerald-50 hover:bg-emerald-100 text-emerald-700 px-4 py-3 rounded-xl border border-dashed border-emerald-300 flex flex-col items-center gap-2 transition text-center">
                    ${Icon("upload-cloud", "w-8 h-8")}
                    <span class="text-sm font-medium">${state.formData.cacName || "Click to upload PDF/Image"}</span>
                    <input type="file" accept="image/*,.pdf" class="hidden" onchange="handleCACUpload(event)">
                  </label>
                </div>

                <button onclick="submitForm('license')" class="w-full bg-emerald-800 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-emerald-900 transition flex justify-center items-center">
                  ${state.isLoading ? Icon("loader-2", "animate-spin mr-2") : ""}
                  ${state.isLoading ? t("processing") : t("submit")}
                </button>
              </div>
            </div>
          </div>
        `;
      }

      function renderStatusCheck() {
        return `
          <div class="max-w-md w-full mx-auto px-4 py-8 animate-slide-in-right">
            <button onclick="setView('miner-portal')" class="text-gray-500 mb-4 flex items-center hover:text-gray-900 transition">${Icon("arrow-left", "w-5 h-5 mr-1")} ${t("back")}</button>
            
            <div class="bg-white rounded-2xl shadow-xl p-6 text-center">
              <div class="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                ${Icon("search", "w-8 h-8")}
              </div>
              <h2 class="text-xl font-bold text-gray-800 mb-2">${t("checkStatusTitle")}</h2>
              <p class="text-sm text-gray-500 mb-6">${t("enterId")}</p>
              
              <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-xl mb-4 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="e.g. ART-54321 or YSM-RC..." />
              
              <button onclick="alert('${t("notFound")}')" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 transition">
                Check Now
              </button>
            </div>
          </div>
        `;
      }

      function renderRenewCheck() {
        return `
          <div class="max-w-md w-full mx-auto px-4 py-8 animate-slide-in-right">
            <button onclick="setView('miner-portal')" class="text-gray-500 mb-4 flex items-center hover:text-gray-900 transition">${Icon("arrow-left", "w-5 h-5 mr-1")} ${t("back")}</button>
            
            <div class="bg-white rounded-2xl shadow-xl p-6 text-center">
              <div class="w-16 h-16 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mx-auto mb-4">
                ${Icon("refresh-cw", "w-8 h-8")}
              </div>
              <h2 class="text-xl font-bold text-gray-800 mb-2">${t("renewTitle")}</h2>
              <p class="text-sm text-gray-500 mb-6">Enter your expired license ID to begin renewal.</p>
              
              <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-xl mb-4 focus:ring-2 focus:ring-orange-500 outline-none" placeholder="License Number" />
              
              <button onclick="alert('System up to date. No pending renewals found for this ID.')" class="w-full bg-orange-600 text-white py-3 rounded-xl font-bold hover:bg-orange-700 transition">
                Proceed
              </button>
            </div>
          </div>
        `;
      }

      function renderAdminLogin() {
        return `
          <div class="min-h-[70vh] flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-xl p-8 max-w-sm w-full animate-fade-in-up border border-gray-100">
              <div class="text-center mb-6">
                <div class="w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  ${Icon("lock","w-8 h-8 text-emerald-700")}
                </div>
                <h2 class="text-2xl font-bold text-gray-900">${t("adminLogin")}</h2>
                <p class="text-gray-500 text-sm mt-1">Authorized personnel only</p>
                <div class="mt-2 text-xs text-gray-400">Tip: MD PIN is <span class="font-mono font-bold text-gray-700">3333</span></div>
              </div>

              <form onsubmit="handleAdminLogin(event)" class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Staff ID / Access PIN</label>
                  <input id="admin-pin" type="password" required class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:outline-none" placeholder="••••••" />
                </div>

                <button id="admin-submit" type="submit" class="w-full bg-emerald-800 text-white py-3 rounded-lg font-bold shadow-lg hover:bg-emerald-900 transition-colors flex items-center justify-center">
                  ${t("portalEntry")}
                </button>
              </form>
              
              <div class="mt-4 text-center">
                 <button onclick="setView('landing')" class="text-sm text-gray-500 hover:text-emerald-700">Cancel</button>
              </div>
            </div>
          </div>
        `;
      }

      function renderMDDashboard() {
         const score = complianceScore();
         const autoFlags = computeAutoFlags();
         const openCases = state.complianceCases.filter(c => !c.resolved).length;
         const pipeline = state.dataOps.status;
         
         const pipelineColor = pipeline === "OK" ? "text-green-500" : "text-red-500";

         return `
           <div class="min-h-screen bg-gray-50 text-gray-800 pb-12 animate-fade-in-up font-sans">
              <!-- MD Header (Light Mode) -->
              <div class="bg-white border-b border-gray-200 px-8 py-4 flex justify-between items-center sticky top-[72px] z-30 shadow-sm">
                 <div class="flex items-center">
                    <div class="p-2 bg-emerald-100 rounded-lg mr-3">
                       ${Icon("shield", "w-6 h-6 text-emerald-700")}
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-gray-900 tracking-tight">${t("mdDashboard")}</h2>
                        <div class="text-xs text-gray-500 flex items-center gap-1">
                          <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                          System Operational
                        </div>
                    </div>
                 </div>
                 <div class="flex items-center space-x-6">
                    <button onclick="setView('digital-suite')" class="hidden md:flex items-center gap-2 text-xs bg-gray-100 border border-gray-200 px-3 py-2 rounded-xl hover:bg-gray-200 transition text-gray-600 font-bold">
                       ${Icon("layout-dashboard","w-4 h-4")} ${t("digitalSuite")}
                    </button>
                    <div class="text-right hidden md:block">
                        <div class="text-xs text-gray-400 uppercase font-bold tracking-wider">Local Time</div>
                        <div class="text-lg font-mono font-bold text-gray-800 live-time">${state.timeString}</div>
                    </div>
                    <button onclick="logout()" class="flex items-center bg-gray-100 hover:bg-red-50 text-gray-600 hover:text-red-600 px-4 py-2 rounded-xl transition-colors text-sm font-bold border border-gray-200">
                       ${Icon("log-out","w-4 h-4 mr-2")} ${t("logout")}
                    </button>
                 </div>
              </div>

              <div class="max-w-[1600px] mx-auto p-8">
                 
                 <!-- EXECUTIVE OVERVIEW STATS (Light Mode) -->
                 <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm hover:shadow-md transition">
                       <div class="flex justify-between items-start mb-4">
                          <div>
                             <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Total Revenue</p>
                             <h3 class="text-3xl font-bold text-gray-900 mt-1">₦ 84.5M</h3>
                          </div>
                          <div class="p-3 bg-green-50 text-green-600 rounded-xl">${Icon("banknote", "w-6 h-6")}</div>
                       </div>
                       <div class="w-full bg-gray-100 h-1.5 rounded-full overflow-hidden">
                          <div class="bg-green-500 h-full w-[85%]"></div>
                       </div>
                       <p class="text-xs text-green-600 mt-2 font-medium">+14% vs last month</p>
                    </div>

                    <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm hover:shadow-md transition">
                       <div class="flex justify-between items-start mb-4">
                          <div>
                             <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Compliance Score</p>
                             <h3 class="text-3xl font-bold text-gray-900 mt-1">${score}%</h3>
                          </div>
                          <div class="p-3 bg-yellow-50 text-yellow-600 rounded-xl">${Icon("shield-check", "w-6 h-6")}</div>
                       </div>
                       <div class="w-full bg-gray-100 h-1.5 rounded-full overflow-hidden">
                          <div class="bg-yellow-500 h-full" style="width: ${score}%"></div>
                       </div>
                       <p class="text-xs text-gray-500 mt-2 font-medium">${autoFlags.length} active flags</p>
                    </div>

                    <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm hover:shadow-md transition">
                       <div class="flex justify-between items-start mb-4">
                          <div>
                             <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Active Sites</p>
                             <h3 class="text-3xl font-bold text-gray-900 mt-1">${state.ops.extraction.activeSites}</h3>
                          </div>
                          <div class="p-3 bg-blue-50 text-blue-600 rounded-xl">${Icon("map-pin", "w-6 h-6")}</div>
                       </div>
                       <div class="w-full bg-gray-100 h-1.5 rounded-full overflow-hidden">
                          <div class="bg-blue-500 h-full w-[60%]"></div>
                       </div>
                       <p class="text-xs text-blue-600 mt-2 font-medium">12 new sites added</p>
                    </div>

                    <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm hover:shadow-md transition">
                       <div class="flex justify-between items-start mb-4">
                          <div>
                             <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Data Pipeline</p>
                             <h3 class="text-3xl font-bold text-gray-900 mt-1">${pipeline}</h3>
                          </div>
                          <div class="p-3 bg-purple-50 text-purple-600 rounded-xl">${Icon("database", "w-6 h-6")}</div>
                       </div>
                       <div class="w-full bg-gray-100 h-1.5 rounded-full overflow-hidden">
                          <div class="bg-purple-500 h-full w-[92%]"></div>
                       </div>
                       <p class="text-xs ${pipelineColor} mt-2 font-medium">${state.dataOps.ingestRatePerMin} events/min</p>
                    </div>
                 </div>

                 <div class="grid grid-cols-12 gap-8">
                    <!-- LEFT COLUMN: MAP & ANALYTICS -->
                    <div class="col-span-12 lg:col-span-8 space-y-8">
                       
                       <!-- ANALYTICS ROW -->
                       <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                          <!-- REVENUE CHART -->
                          <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                             <div class="flex justify-between items-center mb-6">
                                <h4 class="font-bold text-gray-800 flex items-center gap-2">
                                   ${Icon("bar-chart-2", "w-4 h-4 text-emerald-600")} Revenue by LGA
                                </h4>
                                <span class="text-xs text-gray-400 bg-gray-50 px-2 py-1 rounded">This Month</span>
                             </div>
                             <div class="flex items-end justify-between h-32 gap-2 mt-4 px-2">
                                <div class="w-full bg-emerald-100 rounded-t relative group h-[40%] hover:bg-emerald-200 transition-all cursor-pointer" title="Potiskum: ₦12M"></div>
                                <div class="w-full bg-emerald-500 rounded-t relative group h-[85%] hover:bg-emerald-600 transition-all cursor-pointer" title="Damaturu: ₦45M"></div>
                                <div class="w-full bg-emerald-200 rounded-t relative group h-[60%] hover:bg-emerald-300 transition-all cursor-pointer" title="Nguru: ₦22M"></div>
                                <div class="w-full bg-emerald-300 rounded-t relative group h-[30%] hover:bg-emerald-400 transition-all cursor-pointer" title="Geidam: ₦9M"></div>
                                <div class="w-full bg-emerald-400 rounded-t relative group h-[70%] hover:bg-emerald-500 transition-all cursor-pointer" title="Fika: ₦35M"></div>
                             </div>
                             <div class="flex justify-between mt-2 text-[10px] text-gray-400 uppercase font-bold px-1">
                                <span>POT</span><span>DAM</span><span>NGU</span><span>GEI</span><span>FIK</span>
                             </div>
                          </div>

                          <!-- PIE CHART -->
                          <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm flex flex-col items-center justify-center relative">
                             <h4 class="absolute top-6 left-6 font-bold text-gray-800 flex items-center gap-2">
                                ${Icon("pie-chart", "w-4 h-4 text-emerald-600")} Mineral Dist.
                             </h4>
                             <div class="mt-8 flex items-center gap-8">
                                <div class="pie-chart relative shadow-inner border-4 border-white ring-1 ring-gray-100"></div>
                                <div class="space-y-3 text-xs">
                                   <div class="flex items-center gap-2">
                                      <span class="w-3 h-3 rounded-full bg-emerald-500"></span>
                                      <span class="font-medium text-gray-600">Gypsum (45%)</span>
                                   </div>
                                   <div class="flex items-center gap-2">
                                      <span class="w-3 h-3 rounded-full bg-yellow-500"></span>
                                      <span class="font-medium text-gray-600">Gold (30%)</span>
                                   </div>
                                   <div class="flex items-center gap-2">
                                      <span class="w-3 h-3 rounded-full bg-blue-500"></span>
                                      <span class="font-medium text-gray-600">Limestone (25%)</span>
                                   </div>
                                </div>
                             </div>
                          </div>
                       </div>

                       <!-- MAP AREA (Light Mode) -->
                       <div class="bg-white rounded-2xl overflow-hidden border border-gray-100 shadow-md relative h-[450px]">
                          <div class="absolute top-4 left-4 z-10 bg-white/90 backdrop-blur px-4 py-2 rounded-lg text-xs border border-gray-200 shadow-sm flex items-center gap-2">
                             <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                             <span class="font-bold text-gray-700">LIVE TRACKING: YOBE-NORTH</span>
                          </div>
                          
                          <div class="w-full h-full bg-blue-50 relative overflow-hidden group cursor-crosshair">
                             <img src="${ASSETS.mapBg}" class="w-full h-full object-cover opacity-60 mix-blend-multiply grayscale-[20%]" />
                             
                             <!-- Map Markers -->
                             <div class="absolute top-1/4 left-1/3 w-4 h-4 bg-yellow-400 rounded-full marker-pulse cursor-pointer border-2 border-white shadow-lg" title="Potiskum Site"></div>
                             <div class="absolute bottom-1/3 right-1/4 w-4 h-4 bg-red-500 rounded-full marker-pulse cursor-pointer border-2 border-white shadow-lg" title="Damaturu Site"></div>
                             <div class="absolute top-1/2 left-1/2 w-4 h-4 bg-emerald-500 rounded-full marker-pulse cursor-pointer border-2 border-white shadow-lg" title="Nguru Site"></div>
                             
                             <!-- Map HUD -->
                             <div class="absolute bottom-6 right-6 bg-white/90 backdrop-blur p-4 rounded-xl border border-gray-200 shadow-lg text-right">
                                <div class="text-[10px] text-gray-400 uppercase font-bold mb-1">Active Personnel</div>
                                <div class="text-2xl font-bold text-gray-800">1,248</div>
                             </div>
                          </div>
                       </div>
                    </div>

                    <!-- RIGHT COLUMN: CCTV & LOGS -->
                    <div class="col-span-12 lg:col-span-4 space-y-6">
                       
                       <!-- LIVE CCTV FEED -->
                       <div class="bg-gray-900 rounded-2xl overflow-hidden shadow-xl border border-gray-800">
                          <div class="bg-gray-800 px-4 py-3 border-b border-gray-700 flex justify-between items-center">
                             <span class="text-xs font-bold text-gray-300 flex items-center gap-2">
                                ${Icon("camera", "w-3 h-3")} SITE SURVEILLANCE
                             </span>
                             <div class="flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span>
                                <span class="text-[10px] font-mono text-red-400">REC</span>
                             </div>
                          </div>
                          
                          <div class="grid grid-cols-2 gap-0.5 bg-black p-0.5">
                             <div class="relative aspect-video bg-gray-800 group overflow-hidden">
                                <img src="https://images.unsplash.com/photo-1629814484838-59265e317454?q=80&w=500&auto=format&fit=crop" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition duration-500"/>
                                <div class="absolute top-2 left-2 text-[8px] bg-black/60 text-white px-1.5 py-0.5 rounded backdrop-blur">CAM-01</div>
                                <div class="absolute bottom-2 right-2 text-[8px] font-mono text-white/80 live-time">${state.timeString}</div>
                             </div>
                             <div class="relative aspect-video bg-gray-800 group overflow-hidden">
                                <img src="https://images.unsplash.com/photo-1599939571322-792a326991f2?q=80&w=500&auto=format&fit=crop" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition duration-500"/>
                                <div class="absolute top-2 left-2 text-[8px] bg-black/60 text-white px-1.5 py-0.5 rounded backdrop-blur">CAM-02</div>
                                <div class="absolute bottom-2 right-2 text-[8px] font-mono text-white/80 live-time">${state.timeString}</div>
                             </div>
                             <div class="relative aspect-video bg-gray-800 group overflow-hidden">
                                <img src="https://images.unsplash.com/photo-1578328819058-b69f3a3b0f6b?q=80&w=500&auto=format&fit=crop" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition duration-500"/>
                                <div class="absolute top-2 left-2 text-[8px] bg-black/60 text-white px-1.5 py-0.5 rounded backdrop-blur">CAM-03</div>
                                <div class="absolute bottom-2 right-2 text-[8px] font-mono text-white/80 live-time">${state.timeString}</div>
                             </div>
                             <div class="relative aspect-video bg-gray-800 group overflow-hidden">
                                <img src="https://images.unsplash.com/photo-1615811361524-788493823740?q=80&w=500&auto=format&fit=crop" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition duration-500"/>
                                <div class="absolute top-2 left-2 text-[8px] bg-black/60 text-white px-1.5 py-0.5 rounded backdrop-blur">CAM-04</div>
                                <div class="absolute bottom-2 right-2 text-[8px] font-mono text-white/80 live-time">${state.timeString}</div>
                             </div>
                          </div>
                       </div>

                       <!-- COMPLIANCE MONITOR WIDGET (Light Mode) -->
                       <div class="bg-white rounded-2xl border border-gray-100 shadow-sm p-6">
                          <h4 class="font-bold text-gray-800 mb-4 flex items-center justify-between">
                             <div class="flex items-center gap-2">${Icon("bell-ring","w-4 h-4 text-yellow-500")} Auto Flags</div>
                             <span class="text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded-full">${autoFlags.length} active</span>
                          </h4>
                          <div class="space-y-3 max-h-[250px] overflow-auto custom-scroll pr-2">
                             ${autoFlags.length > 0 ? autoFlags.map(f => {
                                const c = severityColor(f.severity);
                                return `
                                   <div class="flex gap-3 items-start border-l-2 ${c.dot.replace('bg-', 'border-')} pl-3 py-1">
                                      <div class="text-[10px] text-gray-400 font-mono mt-0.5">Now</div>
                                      <div>
                                         <div class="flex items-center gap-2">
                                            <div class="text-xs font-bold text-gray-800">${f.title}</div>
                                            <span class="px-1.5 py-0.5 rounded text-[10px] font-bold ${c.pill}">${f.severity}</span>
                                         </div>
                                         <div class="text-[10px] text-gray-500 leading-tight mt-0.5">${f.detail}</div>
                                      </div>
                                   </div>
                                `;
                             }).join('') : `<div class="text-sm text-gray-400 text-center py-4">No active flags</div>`}
                          </div>
                          
                          <button onclick="setView('digital-suite'); setDsTab('compliance')" class="w-full mt-4 bg-gray-50 text-gray-600 text-xs font-bold py-2 rounded-lg hover:bg-gray-100 border border-gray-200 transition">
                             Open Full Compliance Suite
                          </button>
                       </div>

                    </div>
                 </div>
              </div>
           </div>
        `;
      }

      function renderAdminDashboard() {
        const q = state.adminSearch.toLowerCase();
        const filtered = state.applications.filter(a =>
          !q || a.name.toLowerCase().includes(q) || a.type.toLowerCase().includes(q) || a.location.toLowerCase().includes(q)
        );

        const score = complianceScore();
        const autoFlags = computeAutoFlags();
        const openCases = state.complianceCases.filter(c => !c.resolved).length;

        return `
          <div class="min-h-screen bg-gray-50 pb-12 animate-fade-in-up">
            <div class="bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center sticky top-[72px] z-30 shadow-sm">
              <h2 class="text-xl font-bold text-emerald-900 flex items-center">
                ${Icon("activity","w-5 h-5 mr-2 text-emerald-600")}
                ${t("dashboard")}
              </h2>
              <div class="flex items-center space-x-4">
                <button onclick="setView('digital-suite')" class="hidden md:flex items-center gap-2 text-sm text-gray-700 bg-gray-100 px-3 py-2 rounded-xl hover:bg-gray-200 transition">
                  ${Icon("layout-dashboard","w-4 h-4")} ${t("digitalSuite")}
                </button>
                <button onclick="logout()" class="flex items-center text-red-600 hover:bg-red-50 px-3 py-2 rounded-xl transition-colors text-sm font-medium">
                  ${Icon("log-out","w-4 h-4 mr-1.5")} ${t("logout")}
                </button>
              </div>
            </div>

            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-start justify-between">
                  <div>
                    <p class="text-sm font-medium text-gray-500">${t("totalRevenue")}</p>
                    <h3 class="text-2xl font-bold text-gray-900 mt-1">₦ 45.2M</h3>
                    <p class="text-xs text-green-600 mt-1 flex items-center">${Icon("trending-up","w-3 h-3 mr-1")} +12%</p>
                  </div>
                  <div class="p-3 bg-blue-50 rounded-lg text-blue-600">${Icon("bar-chart-3","w-6 h-6")}</div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-start justify-between">
                  <div>
                    <p class="text-sm font-medium text-gray-500">${t("activeMiners")}</p>
                    <h3 class="text-2xl font-bold text-gray-900 mt-1">1,240</h3>
                  </div>
                  <div class="p-3 bg-emerald-50 rounded-lg text-emerald-600">${Icon("users","w-6 h-6")}</div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-start justify-between">
                  <div>
                    <p class="text-sm font-medium text-gray-500">${t("pendingApps")}</p>
                    <h3 class="text-2xl font-bold text-gray-900 mt-1">${state.applications.filter(a => a.status === 'Pending').length}</h3>
                  </div>
                  <div class="p-3 bg-orange-50 rounded-lg text-orange-600">${Icon("alert-circle","w-6 h-6")}</div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-start justify-between">
                  <div>
                    <p class="text-sm font-medium text-gray-500">${t("licensesIssued")}</p>
                    <h3 class="text-2xl font-bold text-gray-900 mt-1">${state.applications.filter(a => a.status === 'Approved').length}</h3>
                  </div>
                  <div class="p-3 bg-purple-50 rounded-lg text-purple-600">${Icon("file-check","w-6 h-6")}</div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                  <p class="text-sm font-medium text-gray-500">${t("complianceScore")}</p>
                  <div class="flex items-end justify-between mt-1">
                    <h3 class="text-2xl font-bold text-gray-900">${score}%</h3>
                    <div class="text-xs text-gray-500 flex items-center gap-2">
                      <span class="w-2 h-2 rounded-full ${openCases ? 'bg-yellow-500' : 'bg-emerald-500'}"></span>
                      ${openCases} cases
                    </div>
                  </div>
                  <div class="mt-3 w-full bg-gray-200 h-2 rounded-full overflow-hidden">
                    <div class="bg-emerald-600 h-full" style="width:${score}%"></div>
                  </div>
                </div>
              </div>

              <div class="grid lg:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden lg:col-span-2">
                  <div class="px-6 py-4 border-b border-gray-200 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="flex items-center gap-4">
                      <h3 class="text-lg font-bold text-gray-800">${t("recentActivity")}</h3>
                      <div class="flex gap-2 text-xs">
                        <button onclick="handleSort('date')" class="px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded text-gray-600">Sort Date</button>
                        <button onclick="handleSort('status')" class="px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded text-gray-600">Sort Status</button>
                      </div>
                    </div>
                    <div class="relative w-full md:w-64">
                      <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">${Icon("search","w-4 h-4")}</span>
                      <input type="text" oninput="handleAdminSearch(event)" value="${state.adminSearch}" placeholder="Search..." class="w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-emerald-500 focus:outline-none" />
                    </div>
                  </div>

                  <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-500">
                      <thead class="text-xs text-gray-700 uppercase bg-gray-50 border-b border-gray-200">
                        <tr>
                          <th class="px-6 py-3">ID</th>
                          <th class="px-6 py-3">Name</th>
                          <th class="px-6 py-3">Type</th>
                          <th class="px-6 py-3">Location</th>
                          <th class="px-6 py-3">Status</th>
                          <th class="px-6 py-3">Compliance</th>
                          <th class="px-6 py-3 text-right">Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        ${filtered.map(a => {
                          const today = iso(now());
                          const expired = a.status === "Approved" && a.expiryDate && a.expiryDate < today;
                          const compText = expired ? `<span class="px-2 py-1 rounded-full text-xs font-bold bg-red-100 text-red-700">Expired</span>` :
                                           (a.status === "Approved" ? `<span class="px-2 py-1 rounded-full text-xs font-bold bg-emerald-100 text-emerald-700">OK</span>` :
                                                                     `<span class="px-2 py-1 rounded-full text-xs font-bold bg-gray-100 text-gray-600">N/A</span>`);
                          return `
                            <tr class="bg-white border-b hover:bg-gray-50">
                              <td class="px-6 py-4 font-mono text-gray-900">#${a.id}</td>
                              <td class="px-6 py-4 font-medium text-gray-900">${a.name}</td>
                              <td class="px-6 py-4"><span class="px-2 py-1 rounded-full text-xs font-medium ${a.type === "Artisan" ? "bg-blue-100 text-blue-700" : "bg-purple-100 text-purple-700"}">${a.type}</span></td>
                              <td class="px-6 py-4">${a.location}</td>
                              <td class="px-6 py-4">${statusPill(a.status)}</td>
                              <td class="px-6 py-4">${compText}</td>
                              <td class="px-6 py-4 text-right space-x-2">
                                <button onclick="viewApplication(${a.id})" class="text-blue-600 hover:text-blue-900 font-medium text-xs border border-blue-200 px-2 py-1 rounded hover:bg-blue-50">${t("viewDocs")}</button>
                                ${a.status === 'Pending' ? `
                                  <button onclick="updateStatus(${a.id}, 'Approved')" class="text-green-600 hover:text-green-900 font-medium text-xs border border-green-200 px-2 py-1 rounded hover:bg-green-50">${t("approve")}</button>
                                  <button onclick="updateStatus(${a.id}, 'Rejected')" class="text-red-600 hover:text-red-900 font-medium text-xs border border-red-200 px-2 py-1 rounded hover:bg-red-50">${t("reject")}</button>
                                ` : ''}
                              </td>
                            </tr>
                          `;
                        }).join('')}
                        ${filtered.length === 0 ? `<tr><td colspan="7" class="px-6 py-8 text-center text-gray-400">No results found</td></tr>` : ''}
                      </tbody>
                    </table>
                  </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                  <div class="px-5 py-4 border-b flex items-center justify-between">
                    <div class="font-bold text-gray-900 flex items-center gap-2">
                      ${Icon("shield-check","w-5 h-5 text-emerald-700")} ${t("dsCompliance")}
                    </div>
                    <div class="text-xs text-gray-500">${autoFlags.length} flags</div>
                  </div>

                  <div class="p-5 space-y-3 max-h-[520px] overflow-auto custom-scroll">
                    ${autoFlags.slice(0,10).map(f => {
                      const c = severityColor(f.severity);
                      return `
                        <div class="p-4 rounded-2xl border bg-gray-50">
                          <div class="flex items-start justify-between gap-3">
                            <div>
                              <div class="flex items-center gap-2">
                                <span class="w-2.5 h-2.5 rounded-full ${c.dot}"></span>
                                <div class="font-bold text-gray-900">${f.title}</div>
                                <span class="px-2 py-0.5 rounded-full text-xs font-bold ${c.pill}">${f.severity}</span>
                              </div>
                              <div class="text-sm text-gray-600 mt-1">${f.detail}</div>
                            </div>
                            <button onclick="setView('digital-suite'); setDsTab('compliance')" class="text-xs font-bold px-3 py-2 rounded-xl bg-gray-900 text-white hover:bg-black transition">
                              Open
                            </button>
                          </div>
                        </div>
                      `;
                    }).join('')}
                  </div>

                  <div class="px-5 py-4 border-t bg-gray-50">
                    <div class="flex items-center justify-between">
                      <div class="text-sm text-gray-700 flex items-center gap-2">
                        ${Icon("database","w-4 h-4 text-indigo-700")} ${t("dataPipeline")}:
                        <span class="font-bold">${state.dataOps.status}</span>
                      </div>
                      <button onclick="setView('digital-suite'); setDsTab('data')" class="text-xs font-bold px-3 py-2 rounded-xl bg-indigo-600 text-white hover:bg-indigo-700 transition">
                        View Data
                      </button>
                    </div>
                    <div class="text-xs text-gray-500 mt-2">Last sync: ${new Date(state.dataOps.lastSync).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>
                  </div>
                </div>
              </div>
            </div>
            
            ${state.previewAppId ? renderApplicationPreviewModal() : ''}
          </div>
        `;
      }

      function tabBtn(tab, label, icon) {
        const active = state.dsTab === tab;
        return `
          <button onclick="setDsTab('${tab}')" class="${active ? 'bg-gray-900 text-white' : 'bg-white text-gray-700 hover:bg-gray-50'} flex items-center gap-2 px-4 py-2 rounded-xl border border-gray-200 shadow-sm transition text-sm font-semibold">
            ${Icon(icon, "w-4 h-4")} ${label}
          </button>
        `;
      }

      function renderDigitalSuite() {
         const score = complianceScore();
         const autoFlags = computeAutoFlags();
         const openCases = state.complianceCases.filter(c => !c.resolved).length;
         const pipeline = state.dataOps.status;

         const explore = `
           <div class="grid md:grid-cols-3 gap-4">
             <div class="bg-white rounded-2xl border border-gray-200 shadow-sm p-5">
               <div class="flex items-center gap-3 mb-2">
                 <div class="w-10 h-10 rounded-xl bg-emerald-100 text-emerald-700 flex items-center justify-center">${Icon("map", "w-5 h-5")}</div>
                 <div class="font-bold text-gray-900">${t("dsExplore")}</div>
               </div>
               <p class="text-sm text-gray-600">GIS layers, satellite overlays, drill targets, sample chain-of-custody, and concession mapping.</p>
               <div class="mt-4 grid grid-cols-2 gap-2 text-xs">
                 <div class="bg-gray-50 border rounded-xl p-3"><div class="text-gray-500">Active missions</div><div class="text-lg font-bold text-gray-900">${state.ops.exploration.activeMissions}</div></div>
                 <div class="bg-gray-50 border rounded-xl p-3"><div class="text-gray-500">GIS layers</div><div class="text-lg font-bold text-gray-900">${state.ops.exploration.gisLayers}</div></div>
               </div>
             </div>
             <!-- More mock widgets -->
             <div class="bg-white rounded-2xl border border-gray-200 shadow-sm p-5">
               <div class="flex items-center gap-3 mb-2">
                 <div class="w-10 h-10 rounded-xl bg-indigo-100 text-indigo-700 flex items-center justify-center">${Icon("radar", "w-5 h-5")}</div>
                 <div class="font-bold text-gray-900">Prospecting Toolkit</div>
               </div>
               <ul class="text-sm text-gray-600 space-y-2 mt-3">
                 <li class="flex gap-2">${Icon("check", "w-4 h-4 text-emerald-600 mt-0.5")} Geochemical sampling workflows</li>
                 <li class="flex gap-2">${Icon("check", "w-4 h-4 text-emerald-600 mt-0.5")} Drill program scheduling</li>
               </ul>
             </div>
           </div>`;
         
         // Simply reuse the logic from your input but wrapped in consistent styling
         // For brevity, I am rendering a simplified structure that matches your input logic
         const activeContent = state.dsTab === "explore" ? explore : 
             `<div class="bg-white p-10 rounded-2xl border border-gray-200 text-center text-gray-500">
                ${Icon("lock", "w-12 h-12 mx-auto mb-3 text-gray-300")}
                <h3 class="font-bold text-gray-900">Module Access Restricted</h3>
                <p>Please log in as Administrator to access full ${state.dsTab} analytics.</p>
              </div>`;

         return `
           <div class="animate-fade-in-up">
             <div class="bg-gradient-to-r from-gray-900 to-emerald-900 text-white">
               <div class="max-w-6xl mx-auto px-6 py-12">
                 <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
                   <div>
                     <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/10 text-xs font-bold uppercase tracking-wider">
                       ${Icon("sparkles","w-4 h-4")} ${t("dsTitle")}
                     </div>
                     <h2 class="text-3xl md:text-4xl font-bold mt-3">${t("dsSub")}</h2>
                   </div>
                   <div class="bg-white/10 border border-white/10 rounded-2xl p-5 backdrop-blur-sm min-w-[280px]">
                     <div class="flex items-center justify-between">
                       <div class="text-xs uppercase tracking-wider text-emerald-200">${t("complianceScore")}</div>
                       <div class="px-2 py-1 rounded-full text-xs font-bold bg-yellow-400 text-gray-900">${score}%</div>
                     </div>
                     <button onclick="setView('admin-login')" class="mt-3 w-full bg-white text-gray-900 font-bold py-3 rounded-xl hover:bg-gray-100 transition flex items-center justify-center gap-2">
                       ${Icon("lock","w-4 h-4")} ${t("adminLogin")}
                     </button>
                   </div>
                 </div>
               </div>
             </div>

             <div class="max-w-6xl mx-auto px-6 py-8">
               <div class="flex flex-wrap gap-2 mb-6">
                 ${tabBtn("explore", t("dsExplore"), "map")}
                 ${tabBtn("extract", t("dsExtract"), "truck")}
                 ${tabBtn("logistics", t("dsLogistics"), "route")}
                 ${tabBtn("data", t("dsData"), "database")}
                 ${tabBtn("compliance", t("dsCompliance"), "shield-check")}
               </div>

               ${activeContent}
               
               <div class="mt-8 flex gap-3">
                  <button onclick="setView('miner-portal')" class="px-5 py-3 rounded-xl bg-gray-900 text-white font-bold hover:bg-black transition flex items-center gap-2">
                    ${Icon("arrow-left","w-4 h-4")} Back to Services
                  </button>
               </div>
             </div>
           </div>
         `;
      }

      function renderSuccess() {
        const isArtisan = state.generatedId.startsWith('ART');
        const qrData = encodeURIComponent(`ID:${state.generatedId}|Name:${state.formData.name || state.formData.companyName}|Valid:${state.expiryDate}`);
        const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${qrData}`;

        return `
          <div class="flex-grow flex flex-col items-center py-10 px-4 bg-gray-100">
            <div class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mb-4 animate-bounce">
              ${Icon("check-circle", "w-10 h-10")}
            </div>
            <h2 class="text-2xl font-bold text-emerald-900 mb-8">${t("success")}</h2>

            <div class="w-full max-w-2xl mb-8 flex justify-center">
              ${isArtisan ? `
                <div id="download-target" class="relative w-[340px] h-[540px] bg-gradient-to-br from-green-700 to-green-900 rounded-2xl shadow-2xl overflow-hidden text-white flex flex-col items-center pt-8 pb-4 px-6 border border-yellow-500/30">
                  <div class="flex flex-col items-center mb-6 z-10 text-center">
                    <img src="${ASSETS.coatOfArms}" class="w-12 h-12 object-contain mb-2 drop-shadow-md">
                    <h3 class="text-xs uppercase tracking-widest text-green-200">Federal Republic of Nigeria</h3>
                    <h1 class="text-lg font-bold font-serif text-yellow-400">YOBE STATE GOVERNMENT</h1>
                    <div class="text-[10px] bg-white/20 px-2 py-0.5 rounded text-white mt-1">Certified Artisan Miner</div>
                  </div>
                  <div class="w-32 h-32 rounded-full border-4 border-yellow-400 overflow-hidden shadow-lg mb-4 z-10 bg-gray-300">
                    <img src="${state.formData.photoURL || ASSETS.miningLogo}" class="w-full h-full object-cover">
                  </div>
                  <div class="text-center z-10 w-full space-y-2">
                    <div>
                      <h2 class="text-xl font-bold text-white truncate">${state.formData.name}</h2>
                      <p class="text-xs text-green-300 uppercase">${state.formData.lga} LGA</p>
                    </div>
                    <div class="bg-white/10 rounded-lg p-2 flex justify-between items-center text-xs border border-white/10 mt-2">
                      <div class="text-left">
                        <div class="text-green-300 text-[10px]">Mineral</div>
                        <div class="font-bold text-yellow-300">${state.formData.mineral}</div>
                      </div>
                       <div class="text-right">
                        <div class="text-green-300 text-[10px]">ID Number</div>
                        <div class="font-mono font-bold text-white">${state.generatedId}</div>
                      </div>
                    </div>
                  </div>
                  <div class="mt-auto z-10 w-full flex justify-between items-end">
                     <div class="text-left">
                       <div class="text-[10px] text-green-400">Expires</div>
                       <div class="text-sm font-bold">${formatDate(state.expiryDate)}</div>
                     </div>
                     <div class="bg-white p-1 rounded">
                       <img src="${qrUrl}" class="w-16 h-16">
                     </div>
                  </div>
                </div>
              ` : `
                 <div id="download-target" class="relative w-[800px] bg-[#fcfbf7] text-gray-800 p-10 border-[10px] border-double border-emerald-800 shadow-2xl flex flex-col items-center font-serif aspect-[1.4/1]">
                    <div class="w-full flex justify-between items-start border-b-2 border-emerald-800 pb-4 mb-8 z-10">
                      <img src="${ASSETS.coatOfArms}" class="w-20">
                      <div class="text-center">
                        <h2 class="text-sm uppercase tracking-[0.2em] text-gray-500">Federal Republic of Nigeria</h2>
                        <h1 class="text-3xl font-bold text-emerald-900 mt-1">YOBE STATE GOVERNMENT</h1>
                        <div class="text-emerald-700 font-bold italic mt-1">Ministry of Mineral Resources</div>
                      </div>
                       <div class="w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center border-2 border-emerald-600">
                          <span class="text-3xl">🏜️</span>
                       </div>
                    </div>
                    <h1 class="text-4xl font-bold text-yellow-600 mb-6 z-10 underline decoration-double underline-offset-4">${t("certTitle")}</h1>
                    <div class="text-center max-w-2xl text-lg leading-relaxed z-10 mb-8 space-y-4">
                      <p>${t("certBody")}</p>
                      <div class="my-6 py-4 border-t border-b border-gray-300 bg-emerald-50/50">
                         <div class="text-3xl font-bold text-emerald-900 mb-1 uppercase">${state.formData.companyName}</div>
                         <div class="font-mono text-gray-500 text-sm tracking-widest">RC: ${state.formData.rcNumber}</div>
                      </div>
                      <p>Has been granted a license for <strong class="text-emerald-800 underline">${state.formData.mineral}</strong> mining operations in <strong class="text-emerald-800 underline">${state.formData.lga}</strong> LGA.</p>
                    </div>
                    <div class="w-full mt-auto grid grid-cols-3 gap-8 items-end z-10">
                      <div class="text-center">
                        <img src="${qrUrl}" class="w-24 h-24 mx-auto border p-1 bg-white mb-2">
                        <div class="text-xs text-gray-400 font-sans">Scan to Verify</div>
                      </div>
                      <div class="text-center font-sans">
                        <div class="text-xs text-gray-500 uppercase mb-1">${t("validUntil")}</div>
                        <div class="text-xl font-bold text-red-600">${formatDate(state.expiryDate)}</div>
                      </div>
                      <div class="text-center">
                         <div class="w-32 h-12 mx-auto mb-2 relative">
                           <div class="absolute inset-0 flex items-center justify-center font-cursive text-2xl text-blue-900 rotate-[-10deg] opacity-80" style="font-family: cursive;">Signed</div>
                         </div>
                         <div class="border-t border-gray-800 pt-1 font-bold text-sm uppercase">${t("signature")}</div>
                      </div>
                    </div>
                 </div>
              `}
            </div>

            <div class="flex gap-4">
              <button onclick="downloadElement('download-target', '${isArtisan ? 'MinerID' : 'MiningLicense'}')" class="bg-gray-900 hover:bg-black text-white px-6 py-3 rounded-xl font-bold shadow-lg transition flex items-center gap-2">
                ${Icon("download")} ${isArtisan ? t("downloadID") : t("downloadCert")}
              </button>
              <button onclick="setView('miner-portal')" class="bg-white border border-gray-300 text-gray-700 px-6 py-3 rounded-xl font-bold shadow-sm hover:bg-gray-50 transition">
                ${t("back")}
              </button>
            </div>
          </div>
        `;
      }

      function renderApplicationPreviewModal() {
        const a = state.applications.find(x => x.id === state.previewAppId);
        if (!a) return '';
        const isArtisan = a.type === 'Artisan';
        const qrData = encodeURIComponent(`ID:${a.id}|Name:${a.name}`);
        const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${qrData}`;

        const cardContent = isArtisan ? `
          <div class="relative w-[300px] h-[480px] bg-gradient-to-br from-green-700 to-green-900 rounded-xl shadow-2xl overflow-hidden text-white flex flex-col items-center pt-6 pb-4 px-4 border border-yellow-500/30 mx-auto">
             <div class="flex flex-col items-center mb-4 z-10 text-center">
                <img src="${ASSETS.coatOfArms}" class="w-10 h-10 object-contain mb-1">
                <h3 class="text-[10px] uppercase tracking-widest text-green-200">Federal Republic of Nigeria</h3>
                <h1 class="text-sm font-bold font-serif text-yellow-400">YOBE STATE GOVERNMENT</h1>
             </div>
             <div class="w-24 h-24 rounded-full border-2 border-yellow-400 overflow-hidden shadow-lg mb-2 z-10 bg-gray-300">
                <img src="${a.photoURL || ASSETS.miningLogo}" class="w-full h-full object-cover">
             </div>
             <div class="text-center z-10 w-full">
                <h2 class="text-lg font-bold text-white truncate">${a.name}</h2>
                <p class="text-xs text-green-300 uppercase">${a.location} LGA</p>
                <div class="bg-white/10 rounded p-1 flex justify-between items-center text-[10px] border border-white/10 mt-2">
                   <div class="text-left"><div>Mineral</div><div class="font-bold text-yellow-300">${a.mineral}</div></div>
                   <div class="text-right"><div>ID</div><div class="font-mono font-bold text-white">ART-${a.id}</div></div>
                </div>
             </div>
             <div class="mt-auto z-10 w-full flex justify-between items-end">
                <div class="bg-white p-1 rounded"><img src="${qrUrl}" class="w-12 h-12"></div>
             </div>
          </div>
        ` : `
          <div class="relative w-full bg-[#fcfbf7] text-gray-800 p-6 border-[4px] border-double border-emerald-800 shadow-xl flex flex-col items-center font-serif">
             <div class="w-full flex justify-between items-start border-b border-emerald-800 pb-2 mb-4">
                <img src="${ASSETS.coatOfArms}" class="w-12">
                <div class="text-center">
                   <h1 class="text-xl font-bold text-emerald-900">YOBE STATE GOVT</h1>
                   <div class="text-[10px] text-emerald-700 font-bold italic">Ministry of Mineral Resources</div>
                </div>
             </div>
             <h1 class="text-2xl font-bold text-yellow-600 mb-4 underline decoration-double">LICENSE CERTIFICATE</h1>
             <div class="text-center text-sm mb-4">
                <p>Certified that <strong class="text-emerald-900">${a.name}</strong> (RC:${a.rcNumber || 'N/A'}) is authorized for <strong>${a.mineral}</strong> mining in <strong>${a.location}</strong>.</p>
             </div>
             <div class="mt-auto w-full flex justify-between items-end">
                <img src="${qrUrl}" class="w-16 h-16 border p-1 bg-white">
                <div class="text-center"><div class="text-xl font-cursive text-blue-900">Signed</div><div class="border-t border-gray-800 text-[10px] uppercase">Commissioner</div></div>
             </div>
          </div>
        `;

        return `
          <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in-up">
            <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden">
              <div class="bg-gray-100 px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="font-bold text-gray-800">Application #${a.id} Documents</h3>
                <button onclick="closePreview()" class="text-gray-500 hover:text-gray-800">${Icon("x", "w-6 h-6")}</button>
              </div>
              <div class="p-8 bg-gray-200 flex justify-center">
                ${cardContent}
              </div>
              <div class="bg-gray-50 px-6 py-4 flex justify-end gap-3">
                <button onclick="closePreview()" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">Close</button>
                ${a.status === 'Pending' ? `
                  <button onclick="updateStatus(${a.id}, 'Rejected'); closePreview()" class="px-4 py-2 bg-red-100 text-red-700 hover:bg-red-200 rounded-lg font-medium">Reject</button>
                  <button onclick="updateStatus(${a.id}, 'Approved'); closePreview()" class="px-4 py-2 bg-green-600 text-white hover:bg-green-700 rounded-lg font-bold shadow">Approve</button>
                ` : ''}
              </div>
            </div>
          </div>
        `;
      }

      // --- Main Render Loop ---
      function render() {
        let content = "";
        if (state.view === "landing") content = renderLanding();
        else if (state.view === "miner-portal") content = renderMinerPortal();
        else if (state.view === "digital-suite") content = renderDigitalSuite();
        else if (state.view === "artisan-form") content = renderArtisanForm();
        else if (state.view === "license-form") content = renderLicenseForm();
        else if (state.view === "status-check") content = renderStatusCheck();
        else if (state.view === "renew-check") content = renderRenewCheck();
        else if (state.view === "success") content = renderSuccess();
        else if (state.view === "admin-login") content = renderAdminLogin();
        else if (state.view === "admin-dashboard") content = renderAdminDashboard();
        else if (state.view === "md-dashboard") content = renderMDDashboard();

        const isMD = state.view === "md-dashboard";
        app.innerHTML = `
          ${isMD ? '' : renderHeader()}
          ${content}
          ${isMD ? '' : renderFooter()}
        `;
        
        lucide.createIcons();
      }

      // Init
      render();

    })();
  </script>
</body>
</html>
